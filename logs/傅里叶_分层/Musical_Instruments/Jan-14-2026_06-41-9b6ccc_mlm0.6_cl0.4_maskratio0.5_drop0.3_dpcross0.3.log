Wed 14 Jan 2026 06:41:50 INFO  {'seed': 2020, 'dataset': 'Musical_Instruments', 'bidirectional': False, 'n_heads': 4, 'lr': 0.001, 'tau': 0.07, 'cl_weight': 0.4, 'mlm_weight': 0.6, 'neg_num': 24000, 'text_types': ['title', 'brand', 'features', 'categories', 'description'], 'epochs': 500, 'batch_size': 100, 'num_workers': 8, 'eval_step': 1, 'learner': 'AdamW', 'data_path': './dataset', 'map_path': '.emb_map.json', 'text_index_path': '.code.pq.20_256.pca128.title_brand_features_categories_description.json', 'text_emb_path': '.t5.meta.emb.npy', 'lr_scheduler_type': 'constant', 'gradient_accumulation_steps': 1, 'warmup_steps': 500, 'weight_decay': 0.0001, 'max_his_len': 50, 'n_codes_per_lel': 256, 'code_level': 20, 'early_stop': 100, 'embedding_size': 128, 'hidden_size': 512, 'n_layers': 2, 'n_layers_cross': 2, 'dropout_prob': 0.3, 'dropout_prob_cross': 0.3, 'mask_ratio': 0.5, 'device': 'cuda:0', 'metrics': 'recall@5,ndcg@5,recall@10,ndcg@10', 'valid_metric': 'ndcg@10', 'log_dir': './logs/傅里叶_分层', 'ckpt_dir': './myckpt/', 'resume': None, 'run_local_time': 'Jan-14-2026_06-41', 'save_file_name': 'Jan-14-2026_06-41-9b6ccc_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3'}
Wed 14 Jan 2026 06:42:21 INFO  CCFRec(
  (query_code_embedding): Embedding(5121, 128, padding_idx=0)
  (item_text_embedding): ModuleList(
    (0-4): 5 x Embedding(24588, 128, padding_idx=0)
  )
  (qformer): CrossAttTransformer(
    (layer): ModuleList(
      (0-1): 2 x CrossAttTransformerLayer(
        (self_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.3, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.3, inplace=False)
        )
        (cross_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.3, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.3, inplace=False)
        )
        (feed_forward): FeedForward(
          (linear_1): Linear(in_features=128, out_features=512, bias=True)
          (linear_2): Linear(in_features=512, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.3, inplace=False)
        )
      )
    )
  )
  (fourier_attention): FrequencyAttention(
    (freq_proj): Linear(in_features=128, out_features=128, bias=True)
    (dropout): Dropout(p=0.1, inplace=False)
    (layer_norm): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
  )
  (intra_position_embedding): Embedding(50, 128)
  (intra_transformer): Transformer(
    (layer): ModuleList(
      (0-1): 2 x TransformerLayer(
        (multi_head_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.3, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.3, inplace=False)
        )
        (feed_forward): FeedForward(
          (linear_1): Linear(in_features=128, out_features=512, bias=True)
          (linear_2): Linear(in_features=512, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.3, inplace=False)
        )
      )
    )
  )
  (intra_layer_norm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
  (intra_dropout): Dropout(p=0.3, inplace=False)
  (inter_lstm): LSTM(128, 64, batch_first=True, bidirectional=True)
  (inter_layer_norm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
  (inter_dropout): Dropout(p=0.3, inplace=False)
  (session_position_embedding): Embedding(50, 128)
  (session_attention_w): Linear(in_features=256, out_features=128, bias=True)
  (session_attention_v): Linear(in_features=128, out_features=1, bias=False)
  (residual_gate): Sequential(
    (0): Linear(in_features=256, out_features=128, bias=True)
    (1): Sigmoid()
  )
  (loss_fct): CrossEntropyLoss()
)
Wed 14 Jan 2026 07:19:52 INFO  [Epoch 0] training [time: 2251.26s, loss: 12.7037, mlm_loss: 5.7615, rec_loss: 9.0196, cl_loss: 0.5682, ]
Wed 14 Jan 2026 07:21:29 INFO  [Epoch 0] Saving current: ./myckpt/Musical_Instruments/Jan-14-2026_06-41-9b6ccc_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Wed 14 Jan 2026 07:21:29 INFO  [Epoch 0] Val Result: {'recall@5': 0.03391423945402949, 'ndcg@5': 0.021760155746545336, 'recall@10': 0.05276902453037135, 'ndcg@10': 0.02781633068362589}
Wed 14 Jan 2026 07:58:52 INFO  [Epoch 1] training [time: 2242.19s, loss: 11.6199, mlm_loss: 4.7942, rec_loss: 8.6490, cl_loss: 0.2360, ]
Wed 14 Jan 2026 08:00:29 INFO  [Epoch 1] Saving current: ./myckpt/Musical_Instruments/Jan-14-2026_06-41-9b6ccc_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Wed 14 Jan 2026 08:00:29 INFO  [Epoch 1] Val Result: {'recall@5': 0.0365953446264733, 'ndcg@5': 0.02394423577894617, 'recall@10': 0.057852678493706365, 'ndcg@10': 0.03075704977068596}
Wed 14 Jan 2026 08:37:49 INFO  [Epoch 2] training [time: 2239.78s, loss: 11.3931, mlm_loss: 4.6153, rec_loss: 8.5415, cl_loss: 0.2060, ]
Wed 14 Jan 2026 08:39:24 INFO  [Epoch 2] Saving current: ./myckpt/Musical_Instruments/Jan-14-2026_06-41-9b6ccc_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Wed 14 Jan 2026 08:39:24 INFO  [Epoch 2] Val Result: {'recall@5': 0.039694284371246016, 'ndcg@5': 0.025697163601257348, 'recall@10': 0.06079493027385574, 'ndcg@10': 0.03244811168825496}
Wed 14 Jan 2026 09:16:48 INFO  [Epoch 3] training [time: 2243.66s, loss: 11.2731, mlm_loss: 4.5315, rec_loss: 8.4776, cl_loss: 0.1914, ]
Wed 14 Jan 2026 09:18:25 INFO  [Epoch 3] Saving current: ./myckpt/Musical_Instruments/Jan-14-2026_06-41-9b6ccc_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Wed 14 Jan 2026 09:18:25 INFO  [Epoch 3] Val Result: {'recall@5': 0.0396420550497049, 'ndcg@5': 0.02580829976081898, 'recall@10': 0.06345862567245251, 'ndcg@10': 0.03348306781086853}
Wed 14 Jan 2026 09:55:48 INFO  [Epoch 4] training [time: 2243.58s, loss: 11.1948, mlm_loss: 4.4880, rec_loss: 8.4291, cl_loss: 0.1822, ]
Wed 14 Jan 2026 09:57:24 INFO  [Epoch 4] Saving current: ./myckpt/Musical_Instruments/Jan-14-2026_06-41-9b6ccc_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Wed 14 Jan 2026 09:57:24 INFO  [Epoch 4] Val Result: {'recall@5': 0.040164348265116036, 'ndcg@5': 0.025995705233727844, 'recall@10': 0.06472953916328626, 'ndcg@10': 0.0338921534156718}
Wed 14 Jan 2026 10:34:49 INFO  [Epoch 5] training [time: 2244.98s, loss: 11.1378, mlm_loss: 4.4545, rec_loss: 8.3947, cl_loss: 0.1761, ]
Wed 14 Jan 2026 10:36:25 INFO  [Epoch 5] Saving current: ./myckpt/Musical_Instruments/Jan-14-2026_06-41-9b6ccc_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Wed 14 Jan 2026 10:36:25 INFO  [Epoch 5] Val Result: {'recall@5': 0.041574539946726094, 'ndcg@5': 0.027085794633215074, 'recall@10': 0.06378941137554624, 'ndcg@10': 0.034229301145916505}
Wed 14 Jan 2026 11:13:47 INFO  [Epoch 6] training [time: 2242.45s, loss: 11.0891, mlm_loss: 4.4276, rec_loss: 8.3638, cl_loss: 0.1719, ]
Wed 14 Jan 2026 11:15:25 INFO  [Epoch 6] Saving current: ./myckpt/Musical_Instruments/Jan-14-2026_06-41-9b6ccc_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Wed 14 Jan 2026 11:15:25 INFO  [Epoch 6] Val Result: {'recall@5': 0.042131652709831297, 'ndcg@5': 0.027486264869096243, 'recall@10': 0.06612232107104929, 'ndcg@10': 0.03518628704778045}
Wed 14 Jan 2026 11:52:44 INFO  [Epoch 7] training [time: 2239.16s, loss: 11.0501, mlm_loss: 4.4061, rec_loss: 8.3385, cl_loss: 0.1699, ]
Wed 14 Jan 2026 11:54:23 INFO  [Epoch 7] Val Result: {'recall@5': 0.04218388203137241, 'ndcg@5': 0.027194148884852467, 'recall@10': 0.06660979473876634, 'ndcg@10': 0.035032054673318096}
Wed 14 Jan 2026 12:31:45 INFO  [Epoch 8] training [time: 2240.53s, loss: 11.0167, mlm_loss: 4.3894, rec_loss: 8.3161, cl_loss: 0.1674, ]
Wed 14 Jan 2026 12:33:20 INFO  [Epoch 8] Saving current: ./myckpt/Musical_Instruments/Jan-14-2026_06-41-9b6ccc_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Wed 14 Jan 2026 12:33:20 INFO  [Epoch 8] Val Result: {'recall@5': 0.043158829366806525, 'ndcg@5': 0.027849543412483555, 'recall@10': 0.06749769320496526, 'ndcg@10': 0.035674473017930974}
Wed 14 Jan 2026 13:10:35 INFO  [Epoch 9] training [time: 2235.46s, loss: 10.9873, mlm_loss: 4.3730, rec_loss: 8.2968, cl_loss: 0.1666, ]
Wed 14 Jan 2026 13:12:10 INFO  [Epoch 9] Val Result: {'recall@5': 0.04178345723289054, 'ndcg@5': 0.026407936623373783, 'recall@10': 0.06690576089416599, 'ndcg@10': 0.03448162734281257}
Wed 14 Jan 2026 13:49:34 INFO  [Epoch 10] training [time: 2242.59s, loss: 10.9624, mlm_loss: 4.3581, rec_loss: 8.2818, cl_loss: 0.1644, ]
Wed 14 Jan 2026 13:51:09 INFO  [Epoch 10] Val Result: {'recall@5': 0.042688765472936506, 'ndcg@5': 0.027351440739923454, 'recall@10': 0.06805480596807048, 'ndcg@10': 0.035504894181441315}
Wed 14 Jan 2026 14:28:38 INFO  [Epoch 11] training [time: 2246.73s, loss: 10.9391, mlm_loss: 4.3467, rec_loss: 8.2656, cl_loss: 0.1638, ]
Wed 14 Jan 2026 14:30:12 INFO  [Epoch 11] Saving current: ./myckpt/Musical_Instruments/Jan-14-2026_06-41-9b6ccc_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Wed 14 Jan 2026 14:30:12 INFO  [Epoch 11] Val Result: {'recall@5': 0.04239279931753687, 'ndcg@5': 0.0274181107329605, 'recall@10': 0.06925608036351608, 'ndcg@10': 0.036046515281354115}
Wed 14 Jan 2026 15:07:28 INFO  [Epoch 12] training [time: 2236.01s, loss: 10.9167, mlm_loss: 4.3367, rec_loss: 8.2497, cl_loss: 0.1625, ]
Wed 14 Jan 2026 15:09:03 INFO  [Epoch 12] Val Result: {'recall@5': 0.042601716603701316, 'ndcg@5': 0.027435498471694995, 'recall@10': 0.06779365936036491, 'ndcg@10': 0.03550122158675849}
Wed 14 Jan 2026 15:46:35 INFO  [Epoch 13] training [time: 2252.70s, loss: 10.9017, mlm_loss: 4.3276, rec_loss: 8.2406, cl_loss: 0.1613, ]
Wed 14 Jan 2026 15:48:17 INFO  [Epoch 13] Saving current: ./myckpt/Musical_Instruments/Jan-14-2026_06-41-9b6ccc_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Wed 14 Jan 2026 15:48:17 INFO  [Epoch 13] Val Result: {'recall@5': 0.04341997597451209, 'ndcg@5': 0.027974630809701518, 'recall@10': 0.07094482842667874, 'ndcg@10': 0.03679078038000426}
Wed 14 Jan 2026 16:25:49 INFO  [Epoch 14] training [time: 2251.58s, loss: 10.8851, mlm_loss: 4.3195, rec_loss: 8.2290, cl_loss: 0.1611, ]
Wed 14 Jan 2026 16:27:26 INFO  [Epoch 14] Val Result: {'recall@5': 0.043158829366806525, 'ndcg@5': 0.0275860273538562, 'recall@10': 0.06857709918348161, 'ndcg@10': 0.03572786074747799}
Wed 14 Jan 2026 17:05:17 INFO  [Epoch 15] training [time: 2270.87s, loss: 10.8688, mlm_loss: 4.3146, rec_loss: 8.2157, cl_loss: 0.1609, ]
Wed 14 Jan 2026 17:06:52 INFO  [Epoch 15] Val Result: {'recall@5': 0.04352443461759432, 'ndcg@5': 0.027815548358005652, 'recall@10': 0.06887306533888125, 'ndcg@10': 0.03595967097666277}
Wed 14 Jan 2026 17:44:36 INFO  [Epoch 16] training [time: 2263.85s, loss: 10.8575, mlm_loss: 4.3067, rec_loss: 8.2098, cl_loss: 0.1592, ]
Wed 14 Jan 2026 17:46:14 INFO  [Epoch 16] Val Result: {'recall@5': 0.043332927105276905, 'ndcg@5': 0.027775717288223003, 'recall@10': 0.06934312923275127, 'ndcg@10': 0.03612691159139518}
Wed 14 Jan 2026 18:23:42 INFO  [Epoch 17] training [time: 2248.03s, loss: 10.8431, mlm_loss: 4.3007, rec_loss: 8.1987, cl_loss: 0.1599, ]
Wed 14 Jan 2026 18:25:18 INFO  [Epoch 17] Val Result: {'recall@5': 0.04284545343755985, 'ndcg@5': 0.02742652337096063, 'recall@10': 0.06814185483730566, 'ndcg@10': 0.03552947285493317}
Wed 14 Jan 2026 19:02:52 INFO  [Epoch 18] training [time: 2254.37s, loss: 10.8322, mlm_loss: 4.2974, rec_loss: 8.1903, cl_loss: 0.1589, ]
Wed 14 Jan 2026 19:04:27 INFO  [Epoch 18] Val Result: {'recall@5': 0.043454795522206165, 'ndcg@5': 0.02796578927851501, 'recall@10': 0.06876860669579903, 'ndcg@10': 0.03607652936839059}
Wed 14 Jan 2026 19:42:47 INFO  [Epoch 19] training [time: 2300.47s, loss: 10.8235, mlm_loss: 4.2932, rec_loss: 8.1839, cl_loss: 0.1591, ]
Wed 14 Jan 2026 19:44:24 INFO  [Epoch 19] Val Result: {'recall@5': 0.04343738574835913, 'ndcg@5': 0.02794049432870457, 'recall@10': 0.0690819826250457, 'ndcg@10': 0.036180383354681225}
Wed 14 Jan 2026 20:22:03 INFO  [Epoch 20] training [time: 2258.77s, loss: 10.8126, mlm_loss: 4.2893, rec_loss: 8.1754, cl_loss: 0.1591, ]
Wed 14 Jan 2026 20:23:38 INFO  [Epoch 20] Val Result: {'recall@5': 0.04322846846219468, 'ndcg@5': 0.027914105143503308, 'recall@10': 0.07017879837740908, 'ndcg@10': 0.036570428075721334}
Wed 14 Jan 2026 21:02:13 INFO  [Epoch 21] training [time: 2315.07s, loss: 10.8042, mlm_loss: 4.2864, rec_loss: 8.1688, cl_loss: 0.1589, ]
Wed 14 Jan 2026 21:03:49 INFO  [Epoch 21] Val Result: {'recall@5': 0.04364630303452358, 'ndcg@5': 0.02784975052666462, 'recall@10': 0.0693605390065983, 'ndcg@10': 0.036072371556575875}
Wed 14 Jan 2026 21:41:27 INFO  [Epoch 22] training [time: 2257.56s, loss: 10.7964, mlm_loss: 4.2841, rec_loss: 8.1624, cl_loss: 0.1587, ]
Wed 14 Jan 2026 21:43:01 INFO  [Epoch 22] Val Result: {'recall@5': 0.04449938195302843, 'ndcg@5': 0.028434397275572496, 'recall@10': 0.06993506154355054, 'ndcg@10': 0.0365942404063005}
Wed 14 Jan 2026 22:20:44 INFO  [Epoch 23] training [time: 2262.65s, loss: 10.7897, mlm_loss: 4.2812, rec_loss: 8.1575, cl_loss: 0.1588, ]
Wed 14 Jan 2026 22:22:21 INFO  [Epoch 23] Saving current: ./myckpt/Musical_Instruments/Jan-14-2026_06-41-9b6ccc_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Wed 14 Jan 2026 22:22:21 INFO  [Epoch 23] Val Result: {'recall@5': 0.04430787444071101, 'ndcg@5': 0.028489783274728724, 'recall@10': 0.07043994498511465, 'ndcg@10': 0.036857624526130874}
Wed 14 Jan 2026 22:59:59 INFO  [Epoch 24] training [time: 2258.43s, loss: 10.7821, mlm_loss: 4.2783, rec_loss: 8.1521, cl_loss: 0.1574, ]
Wed 14 Jan 2026 23:01:35 INFO  [Epoch 24] Val Result: {'recall@5': 0.04434269398840509, 'ndcg@5': 0.02832219753801002, 'recall@10': 0.07045735475896168, 'ndcg@10': 0.03667880464005693}
Wed 14 Jan 2026 23:39:11 INFO  [Epoch 25] training [time: 2255.84s, loss: 10.7762, mlm_loss: 4.2768, rec_loss: 8.1470, cl_loss: 0.1579, ]
Wed 14 Jan 2026 23:40:47 INFO  [Epoch 25] Val Result: {'recall@5': 0.043994498511464336, 'ndcg@5': 0.028319114658227736, 'recall@10': 0.07010915928202092, 'ndcg@10': 0.03670586671260396}
Thu 15 Jan 2026 00:18:23 INFO  [Epoch 26] training [time: 2256.05s, loss: 10.7677, mlm_loss: 4.2754, rec_loss: 8.1391, cl_loss: 0.1583, ]
Thu 15 Jan 2026 00:19:58 INFO  [Epoch 26] Val Result: {'recall@5': 0.04359407371298247, 'ndcg@5': 0.027789430863786, 'recall@10': 0.0697261442573861, 'ndcg@10': 0.036155099270144084}
Thu 15 Jan 2026 00:57:40 INFO  [Epoch 27] training [time: 2262.50s, loss: 10.7649, mlm_loss: 4.2739, rec_loss: 8.1375, cl_loss: 0.1575, ]
Thu 15 Jan 2026 00:59:21 INFO  [Epoch 27] Val Result: {'recall@5': 0.043924859416076184, 'ndcg@5': 0.028124670406933557, 'recall@10': 0.07003952018663277, 'ndcg@10': 0.036494733540572116}
Thu 15 Jan 2026 01:37:01 INFO  [Epoch 28] training [time: 2259.25s, loss: 10.7568, mlm_loss: 4.2709, rec_loss: 8.1312, cl_loss: 0.1577, ]
Thu 15 Jan 2026 01:38:36 INFO  [Epoch 28] Val Result: {'recall@5': 0.04343738574835913, 'ndcg@5': 0.027701677888936387, 'recall@10': 0.06916903149428089, 'ndcg@10': 0.035963379119950484}
Thu 15 Jan 2026 02:16:18 INFO  [Epoch 29] training [time: 2261.99s, loss: 10.7526, mlm_loss: 4.2707, rec_loss: 8.1271, cl_loss: 0.1577, ]
Thu 15 Jan 2026 02:17:53 INFO  [Epoch 29] Val Result: {'recall@5': 0.0442556451191699, 'ndcg@5': 0.028064207567449137, 'recall@10': 0.06970873448353906, 'ndcg@10': 0.03623169877240704}
Thu 15 Jan 2026 02:55:34 INFO  [Epoch 30] training [time: 2260.73s, loss: 10.7493, mlm_loss: 4.2698, rec_loss: 8.1240, cl_loss: 0.1586, ]
Thu 15 Jan 2026 02:57:08 INFO  [Epoch 30] Saving current: ./myckpt/Musical_Instruments/Jan-14-2026_06-41-9b6ccc_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Thu 15 Jan 2026 02:57:08 INFO  [Epoch 30] Val Result: {'recall@5': 0.04526541200229809, 'ndcg@5': 0.029044399940921277, 'recall@10': 0.07104928706976096, 'ndcg@10': 0.037309424036710025}
