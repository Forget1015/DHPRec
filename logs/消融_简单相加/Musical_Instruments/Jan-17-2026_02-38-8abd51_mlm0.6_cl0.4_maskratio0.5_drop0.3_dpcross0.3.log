Sat 17 Jan 2026 02:38:05 INFO  {'seed': 2020, 'dataset': 'Musical_Instruments', 'bidirectional': False, 'n_heads': 4, 'lr': 0.001, 'tau': 0.07, 'cl_weight': 0.4, 'mlm_weight': 0.6, 'neg_num': 24000, 'text_types': ['title', 'brand', 'features', 'categories', 'description'], 'epochs': 500, 'batch_size': 100, 'num_workers': 8, 'eval_step': 1, 'learner': 'AdamW', 'data_path': './dataset', 'map_path': '.emb_map.json', 'text_index_path': '.code.pq.20_256.pca128.title_brand_features_categories_description.json', 'text_emb_path': '.t5.meta.emb.npy', 'lr_scheduler_type': 'constant', 'gradient_accumulation_steps': 1, 'warmup_steps': 500, 'weight_decay': 0.0001, 'max_his_len': 50, 'n_codes_per_lel': 256, 'code_level': 20, 'early_stop': 100, 'embedding_size': 128, 'hidden_size': 512, 'n_layers': 2, 'n_layers_cross': 2, 'dropout_prob': 0.3, 'dropout_prob_cross': 0.3, 'mask_ratio': 0.5, 'device': 'cuda:0', 'metrics': 'recall@5,ndcg@5,recall@10,ndcg@10', 'valid_metric': 'ndcg@10', 'log_dir': './logs/消融_简单相加', 'ckpt_dir': './myckpt/', 'resume': None, 'run_local_time': 'Jan-17-2026_02-38', 'save_file_name': 'Jan-17-2026_02-38-8abd51_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3'}
Sat 17 Jan 2026 02:38:35 INFO  MGFSRec(
  (query_code_embedding): Embedding(5121, 128, padding_idx=0)
  (item_text_embedding): ModuleList(
    (0-4): 5 x Embedding(24588, 128, padding_idx=0)
  )
  (qformer): CrossAttTransformer(
    (layer): ModuleList(
      (0-1): 2 x CrossAttTransformerLayer(
        (self_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.3, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.3, inplace=False)
        )
        (cross_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.3, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.3, inplace=False)
        )
        (feed_forward): FeedForward(
          (linear_1): Linear(in_features=128, out_features=512, bias=True)
          (linear_2): Linear(in_features=512, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.3, inplace=False)
        )
      )
    )
  )
  (intra_position_embedding): Embedding(50, 128)
  (intra_transformer): Transformer(
    (layer): ModuleList(
      (0-1): 2 x TransformerLayer(
        (multi_head_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.3, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.3, inplace=False)
        )
        (feed_forward): FeedForward(
          (linear_1): Linear(in_features=128, out_features=512, bias=True)
          (linear_2): Linear(in_features=512, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.3, inplace=False)
        )
      )
    )
  )
  (intra_layer_norm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
  (intra_dropout): Dropout(p=0.3, inplace=False)
  (inter_lstm): LSTM(128, 64, batch_first=True, bidirectional=True)
  (inter_layer_norm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
  (inter_dropout): Dropout(p=0.3, inplace=False)
  (session_position_embedding): Embedding(50, 128)
  (session_attention_w): Linear(in_features=256, out_features=128, bias=True)
  (session_attention_v): Linear(in_features=128, out_features=1, bias=False)
  (output_layer_norm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
  (loss_fct): CrossEntropyLoss()
)
Sat 17 Jan 2026 03:17:23 INFO  [Epoch 0] training [time: 2327.63s, loss: 12.7085, mlm_loss: 5.7716, rec_loss: 9.0129, cl_loss: 0.5816, ]
Sat 17 Jan 2026 03:19:03 INFO  [Epoch 0] Saving current: ./myckpt/Musical_Instruments/Jan-17-2026_02-38-8abd51_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Sat 17 Jan 2026 03:19:03 INFO  [Epoch 0] Val Result: {'recall@5': 0.03495882588485175, 'ndcg@5': 0.022958646904249813, 'recall@10': 0.05529344173819182, 'ndcg@10': 0.029483623235167858}
Sat 17 Jan 2026 03:57:16 INFO  [Epoch 1] training [time: 2293.89s, loss: 11.5974, mlm_loss: 4.7895, rec_loss: 8.6320, cl_loss: 0.2292, ]
Sat 17 Jan 2026 03:58:58 INFO  [Epoch 1] Saving current: ./myckpt/Musical_Instruments/Jan-17-2026_02-38-8abd51_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Sat 17 Jan 2026 03:58:58 INFO  [Epoch 1] Val Result: {'recall@5': 0.03828409268963596, 'ndcg@5': 0.024483314915456657, 'recall@10': 0.060081129546127196, 'ndcg@10': 0.03148407282467583}
Sat 17 Jan 2026 04:37:16 INFO  [Epoch 2] training [time: 2298.17s, loss: 11.3705, mlm_loss: 4.6139, rec_loss: 8.5230, cl_loss: 0.1979, ]
Sat 17 Jan 2026 04:39:00 INFO  [Epoch 2] Saving current: ./myckpt/Musical_Instruments/Jan-17-2026_02-38-8abd51_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Sat 17 Jan 2026 04:39:00 INFO  [Epoch 2] Val Result: {'recall@5': 0.038963073869670434, 'ndcg@5': 0.025473823370683903, 'recall@10': 0.06210066331238357, 'ndcg@10': 0.032930444991593366}
Sat 17 Jan 2026 05:17:23 INFO  [Epoch 3] training [time: 2303.15s, loss: 11.2489, mlm_loss: 4.5339, rec_loss: 8.4551, cl_loss: 0.1835, ]
Sat 17 Jan 2026 05:19:02 INFO  [Epoch 3] Saving current: ./myckpt/Musical_Instruments/Jan-17-2026_02-38-8abd51_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Sat 17 Jan 2026 05:19:02 INFO  [Epoch 3] Val Result: {'recall@5': 0.03974651369278713, 'ndcg@5': 0.025904395341661477, 'recall@10': 0.06342380612475844, 'ndcg@10': 0.03348762433322895}
Sat 17 Jan 2026 05:57:33 INFO  [Epoch 4] training [time: 2310.29s, loss: 11.1704, mlm_loss: 4.4882, rec_loss: 8.4080, cl_loss: 0.1737, ]
Sat 17 Jan 2026 05:59:12 INFO  [Epoch 4] Saving current: ./myckpt/Musical_Instruments/Jan-17-2026_02-38-8abd51_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Sat 17 Jan 2026 05:59:12 INFO  [Epoch 4] Val Result: {'recall@5': 0.039972840752798625, 'ndcg@5': 0.0257899284250721, 'recall@10': 0.06453803165096886, 'ndcg@10': 0.033705259507702645}
Sat 17 Jan 2026 06:37:36 INFO  [Epoch 5] training [time: 2303.87s, loss: 11.1122, mlm_loss: 4.4575, rec_loss: 8.3700, cl_loss: 0.1693, ]
Sat 17 Jan 2026 06:39:16 INFO  [Epoch 5] Saving current: ./myckpt/Musical_Instruments/Jan-17-2026_02-38-8abd51_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Sat 17 Jan 2026 06:39:16 INFO  [Epoch 5] Val Result: {'recall@5': 0.04098260763592681, 'ndcg@5': 0.026451844426611363, 'recall@10': 0.06634864813106078, 'ndcg@10': 0.034599182860043}
Sat 17 Jan 2026 07:17:41 INFO  [Epoch 6] training [time: 2305.34s, loss: 11.0664, mlm_loss: 4.4327, rec_loss: 8.3407, cl_loss: 0.1651, ]
Sat 17 Jan 2026 07:19:26 INFO  [Epoch 6] Saving current: ./myckpt/Musical_Instruments/Jan-17-2026_02-38-8abd51_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Sat 17 Jan 2026 07:19:26 INFO  [Epoch 6] Val Result: {'recall@5': 0.04237538954368983, 'ndcg@5': 0.027303930313823496, 'recall@10': 0.06674907292954264, 'ndcg@10': 0.03510715620041508}
Sat 17 Jan 2026 07:57:53 INFO  [Epoch 7] training [time: 2306.75s, loss: 11.0274, mlm_loss: 4.4107, rec_loss: 8.3156, cl_loss: 0.1636, ]
Sat 17 Jan 2026 07:59:31 INFO  [Epoch 7] Val Result: {'recall@5': 0.04150490085133794, 'ndcg@5': 0.026688642602301495, 'recall@10': 0.06676648270338968, 'ndcg@10': 0.03482335654076939}
Sat 17 Jan 2026 08:37:56 INFO  [Epoch 8] training [time: 2304.79s, loss: 10.9962, mlm_loss: 4.3930, rec_loss: 8.2959, cl_loss: 0.1613, ]
Sat 17 Jan 2026 08:39:37 INFO  [Epoch 8] Saving current: ./myckpt/Musical_Instruments/Jan-17-2026_02-38-8abd51_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Sat 17 Jan 2026 08:39:37 INFO  [Epoch 8] Val Result: {'recall@5': 0.042862863211406886, 'ndcg@5': 0.02758137368533677, 'recall@10': 0.06854227963578753, 'ndcg@10': 0.03583383785050988}
Sat 17 Jan 2026 09:18:00 INFO  [Epoch 9] training [time: 2303.40s, loss: 10.9679, mlm_loss: 4.3782, rec_loss: 8.2768, cl_loss: 0.1604, ]
Sat 17 Jan 2026 09:19:40 INFO  [Epoch 9] Val Result: {'recall@5': 0.04180086700673758, 'ndcg@5': 0.027127764767164615, 'recall@10': 0.06699280976340118, 'ndcg@10': 0.035202499027589575}
Sat 17 Jan 2026 09:58:09 INFO  [Epoch 10] training [time: 2309.84s, loss: 10.9443, mlm_loss: 4.3651, rec_loss: 8.2614, cl_loss: 0.1595, ]
Sat 17 Jan 2026 09:59:48 INFO  [Epoch 10] Val Result: {'recall@5': 0.042410209091383905, 'ndcg@5': 0.02721527241648139, 'recall@10': 0.06822890370654085, 'ndcg@10': 0.03550905650882232}
Sat 17 Jan 2026 10:38:15 INFO  [Epoch 11] training [time: 2306.61s, loss: 10.9208, mlm_loss: 4.3508, rec_loss: 8.2471, cl_loss: 0.1581, ]
Sat 17 Jan 2026 10:39:54 INFO  [Epoch 11] Saving current: ./myckpt/Musical_Instruments/Jan-17-2026_02-38-8abd51_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Sat 17 Jan 2026 10:39:54 INFO  [Epoch 11] Val Result: {'recall@5': 0.04359407371298247, 'ndcg@5': 0.02808168926918751, 'recall@10': 0.0685248698619405, 'ndcg@10': 0.03611268323349312}
Sat 17 Jan 2026 11:18:13 INFO  [Epoch 12] training [time: 2299.55s, loss: 10.9020, mlm_loss: 4.3416, rec_loss: 8.2337, cl_loss: 0.1584, ]
Sat 17 Jan 2026 11:19:52 INFO  [Epoch 12] Val Result: {'recall@5': 0.04225352112676056, 'ndcg@5': 0.0271716638510995, 'recall@10': 0.06803739619422344, 'ndcg@10': 0.03543921735148532}
Sat 17 Jan 2026 11:58:17 INFO  [Epoch 13] training [time: 2304.32s, loss: 10.8841, mlm_loss: 4.3327, rec_loss: 8.2215, cl_loss: 0.1574, ]
Sat 17 Jan 2026 11:59:55 INFO  [Epoch 13] Val Result: {'recall@5': 0.04244502863907798, 'ndcg@5': 0.027494638870286213, 'recall@10': 0.0671843172757186, 'ndcg@10': 0.035423130980482526}
Sat 17 Jan 2026 12:38:08 INFO  [Epoch 14] training [time: 2292.79s, loss: 10.8679, mlm_loss: 4.3248, rec_loss: 8.2104, cl_loss: 0.1565, ]
Sat 17 Jan 2026 12:39:47 INFO  [Epoch 14] Val Result: {'recall@5': 0.04207942338829019, 'ndcg@5': 0.02702680630953619, 'recall@10': 0.06772402026497676, 'ndcg@10': 0.0352467018545694}
Sat 17 Jan 2026 13:18:13 INFO  [Epoch 15] training [time: 2306.08s, loss: 10.8546, mlm_loss: 4.3185, rec_loss: 8.2006, cl_loss: 0.1571, ]
Sat 17 Jan 2026 13:19:53 INFO  [Epoch 15] Saving current: ./myckpt/Musical_Instruments/Jan-17-2026_02-38-8abd51_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Sat 17 Jan 2026 13:19:53 INFO  [Epoch 15] Val Result: {'recall@5': 0.04364630303452358, 'ndcg@5': 0.028120851112123084, 'recall@10': 0.07052699385434984, 'ndcg@10': 0.0367654907126229}
Sat 17 Jan 2026 13:58:10 INFO  [Epoch 16] training [time: 2296.72s, loss: 10.8407, mlm_loss: 4.3126, rec_loss: 8.1911, cl_loss: 0.1550, ]
Sat 17 Jan 2026 13:59:48 INFO  [Epoch 16] Val Result: {'recall@5': 0.042915092532948, 'ndcg@5': 0.027938869454348102, 'recall@10': 0.0689427044342694, 'ndcg@10': 0.036291375064375}
Sat 17 Jan 2026 14:38:03 INFO  [Epoch 17] training [time: 2295.11s, loss: 10.8289, mlm_loss: 4.3076, rec_loss: 8.1821, cl_loss: 0.1558, ]
Sat 17 Jan 2026 14:39:42 INFO  [Epoch 17] Val Result: {'recall@5': 0.04239279931753687, 'ndcg@5': 0.0274075312551058, 'recall@10': 0.06840300144501123, 'ndcg@10': 0.03574237196879516}
Sat 17 Jan 2026 15:17:58 INFO  [Epoch 18] training [time: 2295.99s, loss: 10.8195, mlm_loss: 4.3003, rec_loss: 8.1776, cl_loss: 0.1543, ]
Sat 17 Jan 2026 15:19:36 INFO  [Epoch 18] Val Result: {'recall@5': 0.042793224116018734, 'ndcg@5': 0.027584839558090414, 'recall@10': 0.06835077212347011, 'ndcg@10': 0.035779128151187}
Sat 17 Jan 2026 15:58:00 INFO  [Epoch 19] training [time: 2303.61s, loss: 10.8076, mlm_loss: 4.2966, rec_loss: 8.1676, cl_loss: 0.1553, ]
Sat 17 Jan 2026 15:59:39 INFO  [Epoch 19] Val Result: {'recall@5': 0.04272358502063058, 'ndcg@5': 0.02760108244589489, 'recall@10': 0.06915162172043385, 'ndcg@10': 0.03609195182454995}
Sat 17 Jan 2026 16:37:58 INFO  [Epoch 20] training [time: 2299.01s, loss: 10.7996, mlm_loss: 4.2926, rec_loss: 8.1621, cl_loss: 0.1549, ]
Sat 17 Jan 2026 16:39:36 INFO  [Epoch 20] Val Result: {'recall@5': 0.04300214140218318, 'ndcg@5': 0.027596225334070117, 'recall@10': 0.06925608036351608, 'ndcg@10': 0.036033552454616175}
Sat 17 Jan 2026 17:17:54 INFO  [Epoch 21] training [time: 2297.92s, loss: 10.7876, mlm_loss: 4.2878, rec_loss: 8.1532, cl_loss: 0.1545, ]
Sat 17 Jan 2026 17:19:30 INFO  [Epoch 21] Val Result: {'recall@5': 0.04322846846219468, 'ndcg@5': 0.02771317086175125, 'recall@10': 0.07024843747279723, 'ndcg@10': 0.03638359168557545}
