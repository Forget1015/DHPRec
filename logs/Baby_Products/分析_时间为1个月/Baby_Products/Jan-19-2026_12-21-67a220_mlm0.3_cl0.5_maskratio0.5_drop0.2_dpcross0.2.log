Mon 19 Jan 2026 12:21:12 INFO  {'seed': 2020, 'dataset': 'Baby_Products', 'bidirectional': False, 'n_heads': 2, 'lr': 0.0005, 'tau': 0.07, 'cl_weight': 0.5, 'mlm_weight': 0.3, 'neg_num': 25000, 'text_types': ['title', 'brand', 'features', 'categories', 'description'], 'epochs': 500, 'batch_size': 100, 'num_workers': 8, 'eval_step': 1, 'learner': 'AdamW', 'data_path': './dataset', 'map_path': '.emb_map.json', 'text_index_path': '.code.pq.20_256.pca128.title_brand_features_categories_description.json', 'text_emb_path': '.t5.meta.emb.npy', 'lr_scheduler_type': 'constant', 'gradient_accumulation_steps': 1, 'warmup_steps': 500, 'weight_decay': 0.0001, 'max_his_len': 50, 'n_codes_per_lel': 256, 'code_level': 20, 'early_stop': 100, 'embedding_size': 128, 'hidden_size': 512, 'n_layers': 2, 'n_layers_cross': 2, 'dropout_prob': 0.2, 'dropout_prob_cross': 0.2, 'mask_ratio': 0.5, 'device': 'cuda:1', 'metrics': 'recall@5,ndcg@5,recall@10,ndcg@10', 'valid_metric': 'ndcg@10', 'log_dir': './logs/Baby_Products/分析_时间为1个月', 'ckpt_dir': './myckpt/', 'resume': None, 'run_local_time': 'Jan-19-2026_12-21', 'save_file_name': 'Jan-19-2026_12-21-67a220_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2'}
Mon 19 Jan 2026 12:22:19 INFO  MGFSRec(
  (query_code_embedding): Embedding(5121, 128, padding_idx=0)
  (item_text_embedding): ModuleList(
    (0-4): 5 x Embedding(36014, 128, padding_idx=0)
  )
  (qformer): CrossAttTransformer(
    (layer): ModuleList(
      (0-1): 2 x CrossAttTransformerLayer(
        (self_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.2, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.2, inplace=False)
        )
        (cross_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.2, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.2, inplace=False)
        )
        (feed_forward): FeedForward(
          (linear_1): Linear(in_features=128, out_features=512, bias=True)
          (linear_2): Linear(in_features=512, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.2, inplace=False)
        )
      )
    )
  )
  (fourier_attention): FrequencyAttention(
    (freq_proj): Linear(in_features=128, out_features=128, bias=True)
    (dropout): Dropout(p=0.1, inplace=False)
    (layer_norm): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
  )
  (intra_position_embedding): Embedding(50, 128)
  (intra_transformer): Transformer(
    (layer): ModuleList(
      (0-1): 2 x TransformerLayer(
        (multi_head_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.2, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.2, inplace=False)
        )
        (feed_forward): FeedForward(
          (linear_1): Linear(in_features=128, out_features=512, bias=True)
          (linear_2): Linear(in_features=512, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.2, inplace=False)
        )
      )
    )
  )
  (intra_layer_norm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
  (intra_dropout): Dropout(p=0.2, inplace=False)
  (inter_lstm): LSTM(128, 64, batch_first=True, bidirectional=True)
  (inter_layer_norm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
  (inter_dropout): Dropout(p=0.2, inplace=False)
  (session_position_embedding): Embedding(50, 128)
  (session_attention_w): Linear(in_features=256, out_features=128, bias=True)
  (session_attention_v): Linear(in_features=128, out_features=1, bias=False)
  (residual_gate): Sequential(
    (0): Linear(in_features=256, out_features=128, bias=True)
    (1): Sigmoid()
  )
  (loss_fct): CrossEntropyLoss()
)
Mon 19 Jan 2026 13:36:28 INFO  [Epoch 0] training [time: 4449.20s, loss: 10.7403, mlm_loss: 5.5441, rec_loss: 8.9575, cl_loss: 0.2392, ]
Mon 19 Jan 2026 13:41:12 INFO  [Epoch 0] Saving current: ./myckpt/Baby_Products/Jan-19-2026_12-21-67a220_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Mon 19 Jan 2026 13:41:12 INFO  [Epoch 0] Val Result: {'recall@5': 0.023657454386279076, 'ndcg@5': 0.015199239338065822, 'recall@10': 0.03803630527202425, 'ndcg@10': 0.019808430034781575}
Mon 19 Jan 2026 14:56:13 INFO  [Epoch 1] training [time: 4501.07s, loss: 10.0218, mlm_loss: 4.7244, rec_loss: 8.5504, cl_loss: 0.1082, ]
Mon 19 Jan 2026 15:00:57 INFO  [Epoch 1] Saving current: ./myckpt/Baby_Products/Jan-19-2026_12-21-67a220_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Mon 19 Jan 2026 15:00:57 INFO  [Epoch 1] Val Result: {'recall@5': 0.025182885983936542, 'ndcg@5': 0.016173003313676246, 'recall@10': 0.04098768379792674, 'ndcg@10': 0.021250628580336405}
Mon 19 Jan 2026 16:15:50 INFO  [Epoch 2] training [time: 4492.14s, loss: 9.8632, mlm_loss: 4.5939, rec_loss: 8.4359, cl_loss: 0.0984, ]
Mon 19 Jan 2026 16:20:34 INFO  [Epoch 2] Saving current: ./myckpt/Baby_Products/Jan-19-2026_12-21-67a220_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Mon 19 Jan 2026 16:20:34 INFO  [Epoch 2] Val Result: {'recall@5': 0.026124674187707673, 'ndcg@5': 0.016681512973655763, 'recall@10': 0.043202875770177146, 'ndcg@10': 0.022154511504635103}
Mon 19 Jan 2026 17:34:49 INFO  [Epoch 3] training [time: 4454.34s, loss: 9.7664, mlm_loss: 4.5104, rec_loss: 8.3660, cl_loss: 0.0946, ]
Mon 19 Jan 2026 17:39:32 INFO  [Epoch 3] Saving current: ./myckpt/Baby_Products/Jan-19-2026_12-21-67a220_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Mon 19 Jan 2026 17:39:32 INFO  [Epoch 3] Val Result: {'recall@5': 0.02802814752913243, 'ndcg@5': 0.017916228447492893, 'recall@10': 0.04509308448901358, 'ndcg@10': 0.02340525241462233}
Mon 19 Jan 2026 18:54:27 INFO  [Epoch 4] training [time: 4495.43s, loss: 9.6961, mlm_loss: 4.4531, rec_loss: 8.3145, cl_loss: 0.0913, ]
Mon 19 Jan 2026 18:59:06 INFO  [Epoch 4] Val Result: {'recall@5': 0.028087838330779893, 'ndcg@5': 0.017998939083821712, 'recall@10': 0.04490074746148285, 'ndcg@10': 0.023393864282453904}
Mon 19 Jan 2026 20:14:53 INFO  [Epoch 5] training [time: 4546.70s, loss: 9.6428, mlm_loss: 4.4097, rec_loss: 8.2752, cl_loss: 0.0894, ]
Mon 19 Jan 2026 20:19:37 INFO  [Epoch 5] Saving current: ./myckpt/Baby_Products/Jan-19-2026_12-21-67a220_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Mon 19 Jan 2026 20:19:37 INFO  [Epoch 5] Val Result: {'recall@5': 0.028134264509839035, 'ndcg@5': 0.01799653848527781, 'recall@10': 0.04519256915842602, 'ndcg@10': 0.023473000382651592}
Mon 19 Jan 2026 21:35:22 INFO  [Epoch 6] training [time: 4544.94s, loss: 9.6022, mlm_loss: 4.3774, rec_loss: 8.2450, cl_loss: 0.0879, ]
Mon 19 Jan 2026 21:40:06 INFO  [Epoch 6] Saving current: ./myckpt/Baby_Products/Jan-19-2026_12-21-67a220_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Mon 19 Jan 2026 21:40:06 INFO  [Epoch 6] Val Result: {'recall@5': 0.028571997055253786, 'ndcg@5': 0.018307881427407198, 'recall@10': 0.04612109273960883, 'ndcg@10': 0.0239377968562826}
Mon 19 Jan 2026 22:55:50 INFO  [Epoch 7] training [time: 4543.47s, loss: 9.5702, mlm_loss: 4.3513, rec_loss: 8.2213, cl_loss: 0.0871, ]
Mon 19 Jan 2026 23:00:34 INFO  [Epoch 7] Saving current: ./myckpt/Baby_Products/Jan-19-2026_12-21-67a220_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Mon 19 Jan 2026 23:00:34 INFO  [Epoch 7] Val Result: {'recall@5': 0.028704643281137043, 'ndcg@5': 0.018438763689729, 'recall@10': 0.04649250217208195, 'ndcg@10': 0.024154066916348638}
Tue 20 Jan 2026 00:16:22 INFO  [Epoch 8] training [time: 4547.70s, loss: 9.5403, mlm_loss: 4.3300, rec_loss: 8.1982, cl_loss: 0.0862, ]
Tue 20 Jan 2026 00:21:08 INFO  [Epoch 8] Saving current: ./myckpt/Baby_Products/Jan-19-2026_12-21-67a220_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Tue 20 Jan 2026 00:21:08 INFO  [Epoch 8] Val Result: {'recall@5': 0.029467359079965776, 'ndcg@5': 0.01873914273424793, 'recall@10': 0.04689044084973172, 'ndcg@10': 0.024328977284665515}
Tue 20 Jan 2026 01:37:01 INFO  [Epoch 9] training [time: 4553.45s, loss: 9.5167, mlm_loss: 4.3123, rec_loss: 8.1802, cl_loss: 0.0857, ]
Tue 20 Jan 2026 01:41:44 INFO  [Epoch 9] Saving current: ./myckpt/Baby_Products/Jan-19-2026_12-21-67a220_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Tue 20 Jan 2026 01:41:44 INFO  [Epoch 9] Val Result: {'recall@5': 0.02983213620114474, 'ndcg@5': 0.01915703129230583, 'recall@10': 0.04784549367609118, 'ndcg@10': 0.024941661984148038}
