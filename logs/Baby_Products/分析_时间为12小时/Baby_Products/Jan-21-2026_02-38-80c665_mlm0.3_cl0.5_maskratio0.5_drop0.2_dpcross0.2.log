Wed 21 Jan 2026 02:38:17 INFO  {'seed': 2020, 'dataset': 'Baby_Products', 'bidirectional': False, 'n_heads': 2, 'lr': 0.0005, 'tau': 0.07, 'cl_weight': 0.5, 'mlm_weight': 0.3, 'neg_num': 25000, 'text_types': ['title', 'brand', 'features', 'categories', 'description'], 'epochs': 500, 'batch_size': 100, 'num_workers': 8, 'eval_step': 1, 'learner': 'AdamW', 'data_path': './dataset', 'map_path': '.emb_map.json', 'text_index_path': '.code.pq.20_256.pca128.title_brand_features_categories_description.json', 'text_emb_path': '.t5.meta.emb.npy', 'lr_scheduler_type': 'constant', 'gradient_accumulation_steps': 1, 'warmup_steps': 500, 'weight_decay': 0.0001, 'max_his_len': 50, 'n_codes_per_lel': 256, 'code_level': 20, 'early_stop': 100, 'embedding_size': 128, 'hidden_size': 512, 'n_layers': 2, 'n_layers_cross': 2, 'dropout_prob': 0.2, 'dropout_prob_cross': 0.2, 'mask_ratio': 0.5, 'device': 'cuda:0', 'metrics': 'recall@5,ndcg@5,recall@10,ndcg@10', 'valid_metric': 'ndcg@10', 'log_dir': './logs/Baby_Products/分析_时间为12小时', 'ckpt_dir': './myckpt/', 'resume': None, 'run_local_time': 'Jan-21-2026_02-38', 'save_file_name': 'Jan-21-2026_02-38-80c665_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2'}
Wed 21 Jan 2026 02:39:26 INFO  MGFSRec(
  (query_code_embedding): Embedding(5121, 128, padding_idx=0)
  (item_text_embedding): ModuleList(
    (0-4): 5 x Embedding(36014, 128, padding_idx=0)
  )
  (qformer): CrossAttTransformer(
    (layer): ModuleList(
      (0-1): 2 x CrossAttTransformerLayer(
        (self_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.2, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.2, inplace=False)
        )
        (cross_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.2, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.2, inplace=False)
        )
        (feed_forward): FeedForward(
          (linear_1): Linear(in_features=128, out_features=512, bias=True)
          (linear_2): Linear(in_features=512, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.2, inplace=False)
        )
      )
    )
  )
  (fourier_attention): FrequencyAttention(
    (freq_proj): Linear(in_features=128, out_features=128, bias=True)
    (dropout): Dropout(p=0.1, inplace=False)
    (layer_norm): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
  )
  (intra_position_embedding): Embedding(50, 128)
  (intra_transformer): Transformer(
    (layer): ModuleList(
      (0-1): 2 x TransformerLayer(
        (multi_head_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.2, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.2, inplace=False)
        )
        (feed_forward): FeedForward(
          (linear_1): Linear(in_features=128, out_features=512, bias=True)
          (linear_2): Linear(in_features=512, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.2, inplace=False)
        )
      )
    )
  )
  (intra_layer_norm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
  (intra_dropout): Dropout(p=0.2, inplace=False)
  (inter_lstm): LSTM(128, 64, batch_first=True, bidirectional=True)
  (inter_layer_norm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
  (inter_dropout): Dropout(p=0.2, inplace=False)
  (session_position_embedding): Embedding(50, 128)
  (session_attention_w): Linear(in_features=256, out_features=128, bias=True)
  (session_attention_v): Linear(in_features=128, out_features=1, bias=False)
  (residual_gate): Sequential(
    (0): Linear(in_features=256, out_features=128, bias=True)
    (1): Sigmoid()
  )
  (loss_fct): CrossEntropyLoss()
)
Wed 21 Jan 2026 04:01:05 INFO  [Epoch 0] training [time: 4899.35s, loss: 10.7083, mlm_loss: 5.5423, rec_loss: 8.9338, cl_loss: 0.2236, ]
Wed 21 Jan 2026 04:08:31 INFO  [Epoch 0] Saving current: ./myckpt/Baby_Products/Jan-21-2026_02-38-80c665_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Wed 21 Jan 2026 04:08:31 INFO  [Epoch 0] Val Result: {'recall@5': 0.02371714518792654, 'ndcg@5': 0.015356419097556789, 'recall@10': 0.03852046399649814, 'ndcg@10': 0.020113798480672167}
Wed 21 Jan 2026 05:30:46 INFO  [Epoch 1] training [time: 4934.81s, loss: 10.0013, mlm_loss: 4.7349, rec_loss: 8.5336, cl_loss: 0.0945, ]
Wed 21 Jan 2026 05:35:28 INFO  [Epoch 1] Saving current: ./myckpt/Baby_Products/Jan-21-2026_02-38-80c665_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Wed 21 Jan 2026 05:35:28 INFO  [Epoch 1] Val Result: {'recall@5': 0.025481339992173873, 'ndcg@5': 0.016347581085964288, 'recall@10': 0.041478474833694795, 'ndcg@10': 0.021467600172132433}
Wed 21 Jan 2026 06:58:07 INFO  [Epoch 2] training [time: 4959.12s, loss: 9.8444, mlm_loss: 4.6046, rec_loss: 8.4206, cl_loss: 0.0849, ]
Wed 21 Jan 2026 07:02:50 INFO  [Epoch 2] Saving current: ./myckpt/Baby_Products/Jan-21-2026_02-38-80c665_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Wed 21 Jan 2026 07:02:50 INFO  [Epoch 2] Val Result: {'recall@5': 0.026177732678060978, 'ndcg@5': 0.016839717221111272, 'recall@10': 0.04293095100711647, 'ndcg@10': 0.022225684035971343}
Wed 21 Jan 2026 08:25:12 INFO  [Epoch 3] training [time: 4942.30s, loss: 9.7465, mlm_loss: 4.5185, rec_loss: 8.3507, cl_loss: 0.0806, ]
Wed 21 Jan 2026 08:29:56 INFO  [Epoch 3] Saving current: ./myckpt/Baby_Products/Jan-21-2026_02-38-80c665_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Wed 21 Jan 2026 08:29:56 INFO  [Epoch 3] Val Result: {'recall@5': 0.027318490220656997, 'ndcg@5': 0.01766345567983827, 'recall@10': 0.0444099564257148, 'ndcg@10': 0.0231532761621979}
Wed 21 Jan 2026 09:52:59 INFO  [Epoch 4] training [time: 4983.23s, loss: 9.6755, mlm_loss: 4.4563, rec_loss: 8.2992, cl_loss: 0.0789, ]
Wed 21 Jan 2026 09:57:41 INFO  [Epoch 4] Saving current: ./myckpt/Baby_Products/Jan-21-2026_02-38-80c665_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Wed 21 Jan 2026 09:57:41 INFO  [Epoch 4] Val Result: {'recall@5': 0.028797495639255325, 'ndcg@5': 0.018508835066395585, 'recall@10': 0.045471126232780865, 'ndcg@10': 0.02385846942168454}
Wed 21 Jan 2026 11:21:24 INFO  [Epoch 5] training [time: 5022.81s, loss: 9.6231, mlm_loss: 4.4134, rec_loss: 8.2603, cl_loss: 0.0775, ]
Wed 21 Jan 2026 11:26:07 INFO  [Epoch 5] Saving current: ./myckpt/Baby_Products/Jan-21-2026_02-38-80c665_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Wed 21 Jan 2026 11:26:07 INFO  [Epoch 5] Val Result: {'recall@5': 0.02855873243266546, 'ndcg@5': 0.01821513463818061, 'recall@10': 0.046286900521962895, 'ndcg@10': 0.023903402190846728}
Wed 21 Jan 2026 12:50:00 INFO  [Epoch 6] training [time: 5032.52s, loss: 9.5821, mlm_loss: 4.3817, rec_loss: 8.2292, cl_loss: 0.0767, ]
Wed 21 Jan 2026 12:54:45 INFO  [Epoch 6] Saving current: ./myckpt/Baby_Products/Jan-21-2026_02-38-80c665_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Wed 21 Jan 2026 12:54:45 INFO  [Epoch 6] Val Result: {'recall@5': 0.02876433408278451, 'ndcg@5': 0.01826159078796699, 'recall@10': 0.04635322363490453, 'ndcg@10': 0.023911774911951143}
Wed 21 Jan 2026 14:18:52 INFO  [Epoch 7] training [time: 5046.46s, loss: 9.5472, mlm_loss: 4.3560, rec_loss: 8.2025, cl_loss: 0.0758, ]
Wed 21 Jan 2026 14:23:34 INFO  [Epoch 7] Saving current: ./myckpt/Baby_Products/Jan-21-2026_02-38-80c665_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Wed 21 Jan 2026 14:23:34 INFO  [Epoch 7] Val Result: {'recall@5': 0.029328080542788355, 'ndcg@5': 0.018754473425660376, 'recall@10': 0.047056248632085795, 'ndcg@10': 0.02445652225415916}
Wed 21 Jan 2026 15:47:49 INFO  [Epoch 8] training [time: 5054.82s, loss: 9.5190, mlm_loss: 4.3344, rec_loss: 8.1812, cl_loss: 0.0749, ]
Wed 21 Jan 2026 15:52:31 INFO  [Epoch 8] Val Result: {'recall@5': 0.029467359079965776, 'ndcg@5': 0.018807587566306915, 'recall@10': 0.04682411773679009, 'ndcg@10': 0.02438176902805512}
Wed 21 Jan 2026 17:16:30 INFO  [Epoch 9] training [time: 5039.71s, loss: 9.4932, mlm_loss: 4.3158, rec_loss: 8.1614, cl_loss: 0.0743, ]
Wed 21 Jan 2026 17:21:14 INFO  [Epoch 9] Saving current: ./myckpt/Baby_Products/Jan-21-2026_02-38-80c665_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Wed 21 Jan 2026 17:21:14 INFO  [Epoch 9] Val Result: {'recall@5': 0.030051002473852114, 'ndcg@5': 0.019288510752830182, 'recall@10': 0.047905184477738644, 'ndcg@10': 0.02500938729500405}
Wed 21 Jan 2026 18:44:56 INFO  [Epoch 10] training [time: 5022.42s, loss: 9.4712, mlm_loss: 4.3000, rec_loss: 8.1441, cl_loss: 0.0742, ]
Wed 21 Jan 2026 18:49:38 INFO  [Epoch 10] Saving current: ./myckpt/Baby_Products/Jan-21-2026_02-38-80c665_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Wed 21 Jan 2026 18:49:38 INFO  [Epoch 10] Val Result: {'recall@5': 0.030004576294792973, 'ndcg@5': 0.01944540784773855, 'recall@10': 0.04797150759068028, 'ndcg@10': 0.02521874939724819}
Wed 21 Jan 2026 20:13:20 INFO  [Epoch 11] training [time: 5021.97s, loss: 9.4515, mlm_loss: 4.2864, rec_loss: 8.1286, cl_loss: 0.0740, ]
Wed 21 Jan 2026 20:18:03 INFO  [Epoch 11] Saving current: ./myckpt/Baby_Products/Jan-21-2026_02-38-80c665_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Wed 21 Jan 2026 20:18:03 INFO  [Epoch 11] Val Result: {'recall@5': 0.03049536733056103, 'ndcg@5': 0.019612406733708444, 'recall@10': 0.048449034003860005, 'ndcg@10': 0.025387835980601764}
Wed 21 Jan 2026 21:41:55 INFO  [Epoch 12] training [time: 5032.21s, loss: 9.4349, mlm_loss: 4.2743, rec_loss: 8.1158, cl_loss: 0.0736, ]
Wed 21 Jan 2026 21:46:37 INFO  [Epoch 12] Saving current: ./myckpt/Baby_Products/Jan-21-2026_02-38-80c665_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Wed 21 Jan 2026 21:46:37 INFO  [Epoch 12] Val Result: {'recall@5': 0.030813718272680847, 'ndcg@5': 0.019698962103850335, 'recall@10': 0.048853604992803945, 'ndcg@10': 0.025494674262621808}
Wed 21 Jan 2026 23:10:19 INFO  [Epoch 13] training [time: 5022.31s, loss: 9.4189, mlm_loss: 4.2631, rec_loss: 8.1033, cl_loss: 0.0733, ]
Wed 21 Jan 2026 23:15:01 INFO  [Epoch 13] Saving current: ./myckpt/Baby_Products/Jan-21-2026_02-38-80c665_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Wed 21 Jan 2026 23:15:01 INFO  [Epoch 13] Val Result: {'recall@5': 0.03011069327549958, 'ndcg@5': 0.01955063018062306, 'recall@10': 0.048628106408802406, 'ndcg@10': 0.025501951747736083}
Thu 22 Jan 2026 00:38:26 INFO  [Epoch 14] training [time: 5005.58s, loss: 9.4045, mlm_loss: 4.2529, rec_loss: 8.0920, cl_loss: 0.0732, ]
Thu 22 Jan 2026 00:43:10 INFO  [Epoch 14] Saving current: ./myckpt/Baby_Products/Jan-21-2026_02-38-80c665_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Thu 22 Jan 2026 00:43:10 INFO  [Epoch 14] Val Result: {'recall@5': 0.030515264264443516, 'ndcg@5': 0.019655238730984747, 'recall@10': 0.04917858824621792, 'ndcg@10': 0.025644601778553745}
Thu 22 Jan 2026 02:06:32 INFO  [Epoch 15] training [time: 5001.66s, loss: 9.3912, mlm_loss: 4.2444, rec_loss: 8.0814, cl_loss: 0.0729, ]
Thu 22 Jan 2026 02:11:19 INFO  [Epoch 15] Val Result: {'recall@5': 0.03013722252067623, 'ndcg@5': 0.019501645407641623, 'recall@10': 0.04877401725727399, 'ndcg@10': 0.025470321561632432}
