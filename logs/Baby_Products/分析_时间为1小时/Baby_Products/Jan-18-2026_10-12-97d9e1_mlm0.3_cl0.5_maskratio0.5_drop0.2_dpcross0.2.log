Sun 18 Jan 2026 10:12:34 INFO  {'seed': 2020, 'dataset': 'Baby_Products', 'bidirectional': False, 'n_heads': 2, 'lr': 0.0005, 'tau': 0.07, 'cl_weight': 0.5, 'mlm_weight': 0.3, 'neg_num': 25000, 'text_types': ['title', 'brand', 'features', 'categories', 'description'], 'epochs': 500, 'batch_size': 90, 'num_workers': 8, 'eval_step': 1, 'learner': 'AdamW', 'data_path': './dataset', 'map_path': '.emb_map.json', 'text_index_path': '.code.pq.20_256.pca128.title_brand_features_categories_description.json', 'text_emb_path': '.t5.meta.emb.npy', 'lr_scheduler_type': 'constant', 'gradient_accumulation_steps': 1, 'warmup_steps': 500, 'weight_decay': 0.0001, 'max_his_len': 50, 'n_codes_per_lel': 256, 'code_level': 20, 'early_stop': 100, 'embedding_size': 128, 'hidden_size': 512, 'n_layers': 2, 'n_layers_cross': 2, 'dropout_prob': 0.2, 'dropout_prob_cross': 0.2, 'mask_ratio': 0.5, 'device': 'cuda:1', 'metrics': 'recall@5,ndcg@5,recall@10,ndcg@10', 'valid_metric': 'ndcg@10', 'log_dir': './logs/Baby_Products/分析_时间为1小时', 'ckpt_dir': './myckpt/', 'resume': None, 'run_local_time': 'Jan-18-2026_10-12', 'save_file_name': 'Jan-18-2026_10-12-97d9e1_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2'}
Sun 18 Jan 2026 10:13:44 INFO  MGFSRec(
  (query_code_embedding): Embedding(5121, 128, padding_idx=0)
  (item_text_embedding): ModuleList(
    (0-4): 5 x Embedding(36014, 128, padding_idx=0)
  )
  (qformer): CrossAttTransformer(
    (layer): ModuleList(
      (0-1): 2 x CrossAttTransformerLayer(
        (self_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.2, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.2, inplace=False)
        )
        (cross_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.2, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.2, inplace=False)
        )
        (feed_forward): FeedForward(
          (linear_1): Linear(in_features=128, out_features=512, bias=True)
          (linear_2): Linear(in_features=512, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.2, inplace=False)
        )
      )
    )
  )
  (fourier_attention): FrequencyAttention(
    (freq_proj): Linear(in_features=128, out_features=128, bias=True)
    (dropout): Dropout(p=0.1, inplace=False)
    (layer_norm): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
  )
  (intra_position_embedding): Embedding(50, 128)
  (intra_transformer): Transformer(
    (layer): ModuleList(
      (0-1): 2 x TransformerLayer(
        (multi_head_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.2, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.2, inplace=False)
        )
        (feed_forward): FeedForward(
          (linear_1): Linear(in_features=128, out_features=512, bias=True)
          (linear_2): Linear(in_features=512, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.2, inplace=False)
        )
      )
    )
  )
  (intra_layer_norm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
  (intra_dropout): Dropout(p=0.2, inplace=False)
  (inter_lstm): LSTM(128, 64, batch_first=True, bidirectional=True)
  (inter_layer_norm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
  (inter_dropout): Dropout(p=0.2, inplace=False)
  (session_position_embedding): Embedding(50, 128)
  (session_attention_w): Linear(in_features=256, out_features=128, bias=True)
  (session_attention_v): Linear(in_features=128, out_features=1, bias=False)
  (residual_gate): Sequential(
    (0): Linear(in_features=256, out_features=128, bias=True)
    (1): Sigmoid()
  )
  (loss_fct): CrossEntropyLoss()
)
Sun 18 Jan 2026 11:41:33 INFO  [Epoch 0] training [time: 5268.55s, loss: 10.6862, mlm_loss: 5.5186, rec_loss: 8.9278, cl_loss: 0.2057, ]
Sun 18 Jan 2026 11:46:40 INFO  [Epoch 0] Saving current: ./myckpt/Baby_Products/Jan-18-2026_10-12-97d9e1_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Sun 18 Jan 2026 11:46:40 INFO  [Epoch 0] Val Result: {'recall@5': 0.023060546369804414, 'ndcg@5': 0.014623311067059663, 'recall@10': 0.037552146547550354, 'ndcg@10': 0.019268891610067753}
Sun 18 Jan 2026 13:14:24 INFO  [Epoch 1] training [time: 5264.10s, loss: 9.9931, mlm_loss: 4.7101, rec_loss: 8.5355, cl_loss: 0.0892, ]
Sun 18 Jan 2026 13:19:33 INFO  [Epoch 1] Saving current: ./myckpt/Baby_Products/Jan-18-2026_10-12-97d9e1_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Sun 18 Jan 2026 13:19:33 INFO  [Epoch 1] Val Result: {'recall@5': 0.02530889989852564, 'ndcg@5': 0.016086391335191436, 'recall@10': 0.04139888709816484, 'ndcg@10': 0.021242394176345065}
Sun 18 Jan 2026 14:47:15 INFO  [Epoch 2] training [time: 5261.95s, loss: 9.8345, mlm_loss: 4.5783, rec_loss: 8.4212, cl_loss: 0.0795, ]
Sun 18 Jan 2026 14:52:27 INFO  [Epoch 2] Saving current: ./myckpt/Baby_Products/Jan-18-2026_10-12-97d9e1_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Sun 18 Jan 2026 14:52:27 INFO  [Epoch 2] Val Result: {'recall@5': 0.026655259091240707, 'ndcg@5': 0.016931497169015177, 'recall@10': 0.04260596775370249, 'ndcg@10': 0.02206553028846431}
Sun 18 Jan 2026 16:20:29 INFO  [Epoch 3] training [time: 5282.30s, loss: 9.7365, mlm_loss: 4.4931, rec_loss: 8.3502, cl_loss: 0.0767, ]
Sun 18 Jan 2026 16:25:40 INFO  [Epoch 3] Saving current: ./myckpt/Baby_Products/Jan-18-2026_10-12-97d9e1_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Sun 18 Jan 2026 16:25:40 INFO  [Epoch 3] Val Result: {'recall@5': 0.026821066873594777, 'ndcg@5': 0.017352772596353205, 'recall@10': 0.04370029911723937, 'ndcg@10': 0.02277842489345608}
Sun 18 Jan 2026 17:53:30 INFO  [Epoch 4] training [time: 5270.31s, loss: 9.6698, mlm_loss: 4.4386, rec_loss: 8.3006, cl_loss: 0.0754, ]
Sun 18 Jan 2026 17:58:38 INFO  [Epoch 4] Saving current: ./myckpt/Baby_Products/Jan-18-2026_10-12-97d9e1_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Sun 18 Jan 2026 17:58:38 INFO  [Epoch 4] Val Result: {'recall@5': 0.027457768757834417, 'ndcg@5': 0.01769677064937559, 'recall@10': 0.044894115150188686, 'ndcg@10': 0.023286524355777986}
Sun 18 Jan 2026 19:26:05 INFO  [Epoch 5] training [time: 5246.90s, loss: 9.6194, mlm_loss: 4.3991, rec_loss: 8.2627, cl_loss: 0.0741, ]
Sun 18 Jan 2026 19:31:15 INFO  [Epoch 5] Saving current: ./myckpt/Baby_Products/Jan-18-2026_10-12-97d9e1_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Sun 18 Jan 2026 19:31:15 INFO  [Epoch 5] Val Result: {'recall@5': 0.0280148829065441, 'ndcg@5': 0.01803564157194661, 'recall@10': 0.0454644939214867, 'ndcg@10': 0.023640205534918912}
Sun 18 Jan 2026 20:58:53 INFO  [Epoch 6] training [time: 5258.17s, loss: 9.5804, mlm_loss: 4.3715, rec_loss: 8.2324, cl_loss: 0.0731, ]
Sun 18 Jan 2026 21:04:06 INFO  [Epoch 6] Saving current: ./myckpt/Baby_Products/Jan-18-2026_10-12-97d9e1_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Sun 18 Jan 2026 21:04:06 INFO  [Epoch 6] Val Result: {'recall@5': 0.02883065719572614, 'ndcg@5': 0.018383612071330796, 'recall@10': 0.045869064910430635, 'ndcg@10': 0.023841849098352498}
Sun 18 Jan 2026 22:31:42 INFO  [Epoch 7] training [time: 5255.77s, loss: 9.5472, mlm_loss: 4.3467, rec_loss: 8.2068, cl_loss: 0.0728, ]
Sun 18 Jan 2026 22:36:51 INFO  [Epoch 7] Saving current: ./myckpt/Baby_Products/Jan-18-2026_10-12-97d9e1_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Sun 18 Jan 2026 22:36:51 INFO  [Epoch 7] Val Result: {'recall@5': 0.028525570876194645, 'ndcg@5': 0.018298095430630133, 'recall@10': 0.046048137315373036, 'ndcg@10': 0.023919114087993337}
Mon 19 Jan 2026 00:04:29 INFO  [Epoch 8] training [time: 5258.24s, loss: 9.5203, mlm_loss: 4.3271, rec_loss: 8.1861, cl_loss: 0.0722, ]
Mon 19 Jan 2026 00:09:39 INFO  [Epoch 8] Saving current: ./myckpt/Baby_Products/Jan-18-2026_10-12-97d9e1_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Mon 19 Jan 2026 00:09:39 INFO  [Epoch 8] Val Result: {'recall@5': 0.02899646497808021, 'ndcg@5': 0.018600980173739217, 'recall@10': 0.04639964981396367, 'ndcg@10': 0.024196290050816697}
Mon 19 Jan 2026 01:37:21 INFO  [Epoch 9] training [time: 5261.93s, loss: 9.4966, mlm_loss: 4.3114, rec_loss: 8.1674, cl_loss: 0.0714, ]
Mon 19 Jan 2026 01:42:33 INFO  [Epoch 9] Saving current: ./myckpt/Baby_Products/Jan-18-2026_10-12-97d9e1_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Mon 19 Jan 2026 01:42:33 INFO  [Epoch 9] Val Result: {'recall@5': 0.030230074878794512, 'ndcg@5': 0.01932664455610825, 'recall@10': 0.04741439344197059, 'ndcg@10': 0.024835207402507303}
