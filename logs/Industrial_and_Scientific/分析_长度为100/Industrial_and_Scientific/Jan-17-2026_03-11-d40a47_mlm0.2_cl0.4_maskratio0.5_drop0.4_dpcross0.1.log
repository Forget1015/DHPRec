Sat 17 Jan 2026 03:11:04 INFO  {'seed': 2020, 'dataset': 'Industrial_and_Scientific', 'bidirectional': False, 'n_heads': 2, 'lr': 0.0005, 'tau': 0.07, 'cl_weight': 0.4, 'mlm_weight': 0.2, 'neg_num': 25000, 'text_types': ['title', 'brand', 'features', 'categories', 'description'], 'epochs': 500, 'batch_size': 50, 'num_workers': 8, 'eval_step': 1, 'learner': 'AdamW', 'data_path': './dataset', 'map_path': '.emb_map.json', 'text_index_path': '.code.pq.20_256.pca128.title_brand_features_categories_description.json', 'text_emb_path': '.t5.meta.emb.npy', 'lr_scheduler_type': 'constant', 'gradient_accumulation_steps': 1, 'warmup_steps': 500, 'weight_decay': 0.0001, 'max_his_len': 100, 'n_codes_per_lel': 256, 'code_level': 20, 'early_stop': 100, 'embedding_size': 128, 'hidden_size': 512, 'n_layers': 2, 'n_layers_cross': 2, 'dropout_prob': 0.4, 'dropout_prob_cross': 0.1, 'mask_ratio': 0.5, 'device': 'cuda:1', 'metrics': 'recall@5,ndcg@5,recall@10,ndcg@10', 'valid_metric': 'ndcg@10', 'log_dir': './logs/Industrial_and_Scientific/分析_长度为100', 'ckpt_dir': './myckpt/', 'resume': None, 'run_local_time': 'Jan-17-2026_03-11', 'save_file_name': 'Jan-17-2026_03-11-d40a47_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1'}
Sat 17 Jan 2026 03:11:27 INFO  MGFSRec(
  (query_code_embedding): Embedding(5121, 128, padding_idx=0)
  (item_text_embedding): ModuleList(
    (0-4): 5 x Embedding(25849, 128, padding_idx=0)
  )
  (qformer): CrossAttTransformer(
    (layer): ModuleList(
      (0-1): 2 x CrossAttTransformerLayer(
        (self_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.1, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.1, inplace=False)
        )
        (cross_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.1, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.1, inplace=False)
        )
        (feed_forward): FeedForward(
          (linear_1): Linear(in_features=128, out_features=512, bias=True)
          (linear_2): Linear(in_features=512, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.1, inplace=False)
        )
      )
    )
  )
  (fourier_attention): FrequencyAttention(
    (freq_proj): Linear(in_features=128, out_features=128, bias=True)
    (dropout): Dropout(p=0.1, inplace=False)
    (layer_norm): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
  )
  (intra_position_embedding): Embedding(100, 128)
  (intra_transformer): Transformer(
    (layer): ModuleList(
      (0-1): 2 x TransformerLayer(
        (multi_head_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.4, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.4, inplace=False)
        )
        (feed_forward): FeedForward(
          (linear_1): Linear(in_features=128, out_features=512, bias=True)
          (linear_2): Linear(in_features=512, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.4, inplace=False)
        )
      )
    )
  )
  (intra_layer_norm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
  (intra_dropout): Dropout(p=0.4, inplace=False)
  (inter_lstm): LSTM(128, 64, batch_first=True, bidirectional=True)
  (inter_layer_norm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
  (inter_dropout): Dropout(p=0.4, inplace=False)
  (session_position_embedding): Embedding(100, 128)
  (session_attention_w): Linear(in_features=256, out_features=128, bias=True)
  (session_attention_v): Linear(in_features=128, out_features=1, bias=False)
  (residual_gate): Sequential(
    (0): Linear(in_features=256, out_features=128, bias=True)
    (1): Sigmoid()
  )
  (loss_fct): CrossEntropyLoss()
)
Sat 17 Jan 2026 03:49:40 INFO  [Epoch 0] training [time: 2292.49s, loss: 10.8815, mlm_loss: 6.5665, rec_loss: 9.2714, cl_loss: 0.7419, ]
Sat 17 Jan 2026 03:51:51 INFO  [Epoch 0] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_03-11-d40a47_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 03:51:51 INFO  [Epoch 0] Val Result: {'recall@5': 0.023555947827792488, 'ndcg@5': 0.014805451157374324, 'recall@10': 0.038011179758752574, 'ndcg@10': 0.0194466008407714}
Sat 17 Jan 2026 04:30:03 INFO  [Epoch 1] training [time: 2292.64s, loss: 10.0687, mlm_loss: 5.5822, rec_loss: 8.8352, cl_loss: 0.2926, ]
Sat 17 Jan 2026 04:32:14 INFO  [Epoch 1] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_03-11-d40a47_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 04:32:14 INFO  [Epoch 1] Val Result: {'recall@5': 0.02873394135530058, 'ndcg@5': 0.017934898576327747, 'recall@10': 0.04630773756987349, 'ndcg@10': 0.02356213801419418}
Sat 17 Jan 2026 05:10:27 INFO  [Epoch 2] training [time: 2292.80s, loss: 9.8458, mlm_loss: 5.3248, rec_loss: 8.6795, cl_loss: 0.2534, ]
Sat 17 Jan 2026 05:12:39 INFO  [Epoch 2] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_03-11-d40a47_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 05:12:39 INFO  [Epoch 2] Val Result: {'recall@5': 0.02873394135530058, 'ndcg@5': 0.018257072897907612, 'recall@10': 0.04756300872805727, 'ndcg@10': 0.024309079956515017}
Sat 17 Jan 2026 05:50:49 INFO  [Epoch 3] training [time: 2290.20s, loss: 9.7126, mlm_loss: 5.1966, rec_loss: 8.5812, cl_loss: 0.2302, ]
Sat 17 Jan 2026 05:53:01 INFO  [Epoch 3] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_03-11-d40a47_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 05:53:01 INFO  [Epoch 3] Val Result: {'recall@5': 0.032205550652152595, 'ndcg@5': 0.02029722413970429, 'recall@10': 0.05044620966951064, 'ndcg@10': 0.026171229703292855}
Sat 17 Jan 2026 06:31:15 INFO  [Epoch 4] training [time: 2293.80s, loss: 9.6190, mlm_loss: 5.1066, rec_loss: 8.5100, cl_loss: 0.2193, ]
Sat 17 Jan 2026 06:33:29 INFO  [Epoch 4] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_03-11-d40a47_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 06:33:29 INFO  [Epoch 4] Val Result: {'recall@5': 0.03261743650093165, 'ndcg@5': 0.02110534388784966, 'recall@10': 0.051799548886927525, 'ndcg@10': 0.027274751597740517}
Sat 17 Jan 2026 07:11:29 INFO  [Epoch 5] training [time: 2279.29s, loss: 9.5450, mlm_loss: 5.0293, rec_loss: 8.4535, cl_loss: 0.2140, ]
Sat 17 Jan 2026 07:13:41 INFO  [Epoch 5] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_03-11-d40a47_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 07:13:41 INFO  [Epoch 5] Val Result: {'recall@5': 0.03338236736294989, 'ndcg@5': 0.021603429770486033, 'recall@10': 0.05315288810434442, 'ndcg@10': 0.027963080486971173}
Sat 17 Jan 2026 07:51:51 INFO  [Epoch 6] training [time: 2290.59s, loss: 9.4818, mlm_loss: 4.9724, rec_loss: 8.4035, cl_loss: 0.2095, ]
Sat 17 Jan 2026 07:54:02 INFO  [Epoch 6] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_03-11-d40a47_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 07:54:02 INFO  [Epoch 6] Val Result: {'recall@5': 0.034402275178974207, 'ndcg@5': 0.022003745574442395, 'recall@10': 0.05444738648622144, 'ndcg@10': 0.028453323569171064}
Sat 17 Jan 2026 08:32:11 INFO  [Epoch 7] training [time: 2289.07s, loss: 9.4316, mlm_loss: 4.9315, rec_loss: 8.3627, cl_loss: 0.2065, ]
Sat 17 Jan 2026 08:34:24 INFO  [Epoch 7] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_03-11-d40a47_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 08:34:24 INFO  [Epoch 7] Val Result: {'recall@5': 0.03555947827792488, 'ndcg@5': 0.022670146530371527, 'recall@10': 0.05642836128273022, 'ndcg@10': 0.02937566377818029}
Sat 17 Jan 2026 09:12:33 INFO  [Epoch 8] training [time: 2288.59s, loss: 9.3907, mlm_loss: 4.8986, rec_loss: 8.3293, cl_loss: 0.2042, ]
Sat 17 Jan 2026 09:14:44 INFO  [Epoch 8] Val Result: {'recall@5': 0.035951750514857314, 'ndcg@5': 0.022382397686510423, 'recall@10': 0.05682063351966265, 'ndcg@10': 0.02907775938014043}
Sat 17 Jan 2026 09:52:51 INFO  [Epoch 9] training [time: 2286.78s, loss: 9.3525, mlm_loss: 4.8717, rec_loss: 8.2974, cl_loss: 0.2021, ]
Sat 17 Jan 2026 09:55:03 INFO  [Epoch 9] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_03-11-d40a47_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 09:55:03 INFO  [Epoch 9] Val Result: {'recall@5': 0.03597136412670393, 'ndcg@5': 0.023016193361507745, 'recall@10': 0.056232225164264, 'ndcg@10': 0.029545145194600865}
Sat 17 Jan 2026 10:33:13 INFO  [Epoch 10] training [time: 2289.73s, loss: 9.3209, mlm_loss: 4.8487, rec_loss: 8.2716, cl_loss: 0.1987, ]
Sat 17 Jan 2026 10:35:25 INFO  [Epoch 10] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_03-11-d40a47_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 10:35:25 INFO  [Epoch 10] Val Result: {'recall@5': 0.03622634108071001, 'ndcg@5': 0.022849956889286736, 'recall@10': 0.05782092772384034, 'ndcg@10': 0.029807329260275343}
Sat 17 Jan 2026 11:13:34 INFO  [Epoch 11] training [time: 2289.11s, loss: 9.2890, mlm_loss: 4.8286, rec_loss: 8.2446, cl_loss: 0.1966, ]
Sat 17 Jan 2026 11:15:46 INFO  [Epoch 11] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_03-11-d40a47_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 11:15:46 INFO  [Epoch 11] Val Result: {'recall@5': 0.03701088555457487, 'ndcg@5': 0.023361638627637307, 'recall@10': 0.058781994704324804, 'ndcg@10': 0.030358584514374568}
Sat 17 Jan 2026 11:53:51 INFO  [Epoch 12] training [time: 2284.84s, loss: 9.2651, mlm_loss: 4.8115, rec_loss: 8.2251, cl_loss: 0.1941, ]
Sat 17 Jan 2026 11:56:03 INFO  [Epoch 12] Val Result: {'recall@5': 0.037638521133666766, 'ndcg@5': 0.023707148779650886, 'recall@10': 0.05815435912523291, 'ndcg@10': 0.030300278113357598}
Sat 17 Jan 2026 12:33:58 INFO  [Epoch 13] training [time: 2275.14s, loss: 9.2413, mlm_loss: 4.7978, rec_loss: 8.2048, cl_loss: 0.1925, ]
Sat 17 Jan 2026 12:36:08 INFO  [Epoch 13] Val Result: {'recall@5': 0.037108953613807984, 'ndcg@5': 0.023489468307767276, 'recall@10': 0.057918995783073454, 'ndcg@10': 0.030201746059116387}
Sat 17 Jan 2026 13:14:16 INFO  [Epoch 14] training [time: 2287.53s, loss: 9.2200, mlm_loss: 4.7847, rec_loss: 8.1862, cl_loss: 0.1923, ]
Sat 17 Jan 2026 13:16:26 INFO  [Epoch 14] Val Result: {'recall@5': 0.036736294988722176, 'ndcg@5': 0.023396756986408734, 'recall@10': 0.05754633715798765, 'ndcg@10': 0.03008396634520579}
Sat 17 Jan 2026 13:54:29 INFO  [Epoch 15] training [time: 2283.02s, loss: 9.1985, mlm_loss: 4.7741, rec_loss: 8.1670, cl_loss: 0.1918, ]
Sat 17 Jan 2026 13:56:41 INFO  [Epoch 15] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_03-11-d40a47_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 13:56:41 INFO  [Epoch 15] Val Result: {'recall@5': 0.038050406982445814, 'ndcg@5': 0.024399166638750393, 'recall@10': 0.05927233500049034, 'ndcg@10': 0.031206705479150987}
Sat 17 Jan 2026 14:34:46 INFO  [Epoch 16] training [time: 2285.09s, loss: 9.1795, mlm_loss: 4.7631, rec_loss: 8.1508, cl_loss: 0.1903, ]
Sat 17 Jan 2026 14:36:58 INFO  [Epoch 16] Val Result: {'recall@5': 0.037716975581053254, 'ndcg@5': 0.023748160755913714, 'recall@10': 0.058958517210944396, 'ndcg@10': 0.03057572714158036}
Sat 17 Jan 2026 15:15:03 INFO  [Epoch 17] training [time: 2284.80s, loss: 9.1667, mlm_loss: 4.7555, rec_loss: 8.1399, cl_loss: 0.1891, ]
Sat 17 Jan 2026 15:17:14 INFO  [Epoch 17] Val Result: {'recall@5': 0.03738354417966069, 'ndcg@5': 0.023777744247946795, 'recall@10': 0.05862508580955183, 'ndcg@10': 0.03060253372528605}
Sat 17 Jan 2026 15:55:20 INFO  [Epoch 18] training [time: 2285.68s, loss: 9.1502, mlm_loss: 4.7469, rec_loss: 8.1253, cl_loss: 0.1888, ]
Sat 17 Jan 2026 15:57:31 INFO  [Epoch 18] Val Result: {'recall@5': 0.03756006668628028, 'ndcg@5': 0.02373069497350502, 'recall@10': 0.05927233500049034, 'ndcg@10': 0.030716953676705783}
Sat 17 Jan 2026 16:35:38 INFO  [Epoch 19] training [time: 2287.87s, loss: 9.1336, mlm_loss: 4.7405, rec_loss: 8.1105, cl_loss: 0.1875, ]
Sat 17 Jan 2026 16:37:53 INFO  [Epoch 19] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_03-11-d40a47_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 16:37:53 INFO  [Epoch 19] Val Result: {'recall@5': 0.03936451897616946, 'ndcg@5': 0.02487379873665195, 'recall@10': 0.06015494753358831, 'ndcg@10': 0.03154351958062259}
