Sun 18 Jan 2026 03:05:32 INFO  {'seed': 2020, 'dataset': 'Industrial_and_Scientific', 'bidirectional': False, 'n_heads': 2, 'lr': 0.0005, 'tau': 0.07, 'cl_weight': 0.4, 'mlm_weight': 0.2, 'neg_num': 25000, 'text_types': ['title', 'brand', 'features', 'categories', 'description'], 'epochs': 500, 'batch_size': 100, 'num_workers': 8, 'eval_step': 1, 'learner': 'AdamW', 'data_path': './dataset', 'map_path': '.emb_map.json', 'text_index_path': '.code.pq.20_256.pca128.title_brand_features_categories_description.json', 'text_emb_path': '.t5.meta.emb.npy', 'lr_scheduler_type': 'constant', 'gradient_accumulation_steps': 1, 'warmup_steps': 500, 'weight_decay': 0.0001, 'max_his_len': 100, 'n_codes_per_lel': 256, 'code_level': 20, 'early_stop': 100, 'embedding_size': 128, 'hidden_size': 512, 'n_layers': 2, 'n_layers_cross': 2, 'dropout_prob': 0.4, 'dropout_prob_cross': 0.1, 'mask_ratio': 0.5, 'device': 'cuda:1', 'metrics': 'recall@5,ndcg@5,recall@10,ndcg@10', 'valid_metric': 'ndcg@10', 'log_dir': './logs/Industrial_and_Scientific/分析_长度为100_原模型', 'ckpt_dir': './myckpt/', 'resume': None, 'run_local_time': 'Jan-18-2026_03-05', 'save_file_name': 'Jan-18-2026_03-05-d3f421_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1'}
Sun 18 Jan 2026 03:05:55 INFO  MGFSRec(
  (query_code_embedding): Embedding(5121, 128, padding_idx=0)
  (item_text_embedding): ModuleList(
    (0-4): 5 x Embedding(25849, 128, padding_idx=0)
  )
  (qformer): CrossAttTransformer(
    (layer): ModuleList(
      (0-1): 2 x CrossAttTransformerLayer(
        (self_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.1, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.1, inplace=False)
        )
        (cross_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.1, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.1, inplace=False)
        )
        (feed_forward): FeedForward(
          (linear_1): Linear(in_features=128, out_features=512, bias=True)
          (linear_2): Linear(in_features=512, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.1, inplace=False)
        )
      )
    )
  )
  (position_embedding): Embedding(100, 128)
  (transformer): Transformer(
    (layer): ModuleList(
      (0-1): 2 x TransformerLayer(
        (multi_head_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.4, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.4, inplace=False)
        )
        (feed_forward): FeedForward(
          (linear_1): Linear(in_features=128, out_features=512, bias=True)
          (linear_2): Linear(in_features=512, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.4, inplace=False)
        )
      )
    )
  )
  (dropout): Dropout(p=0.4, inplace=False)
  (layer_norm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
  (loss_fct): CrossEntropyLoss()
)
Sun 18 Jan 2026 03:23:38 INFO  [Epoch 0] training [time: 1063.52s, loss: 10.9763, mlm_loss: 6.8933, rec_loss: 9.3015, cl_loss: 0.7404, ]
Sun 18 Jan 2026 03:24:33 INFO  [Epoch 0] Saving current: ./myckpt/Industrial_and_Scientific/Jan-18-2026_03-05-d3f421_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sun 18 Jan 2026 03:24:33 INFO  [Epoch 0] Val Result: {'recall@5': 0.028949691085613415, 'ndcg@5': 0.018228712472492917, 'recall@10': 0.04577817005001471, 'ndcg@10': 0.02362800780097398}
Sun 18 Jan 2026 03:42:22 INFO  [Epoch 1] training [time: 1068.59s, loss: 10.0224, mlm_loss: 5.4783, rec_loss: 8.8229, cl_loss: 0.2596, ]
Sun 18 Jan 2026 03:43:17 INFO  [Epoch 1] Saving current: ./myckpt/Industrial_and_Scientific/Jan-18-2026_03-05-d3f421_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sun 18 Jan 2026 03:43:17 INFO  [Epoch 1] Val Result: {'recall@5': 0.03312739040894381, 'ndcg@5': 0.020668511404948596, 'recall@10': 0.05185838972246739, 'ndcg@10': 0.026696043550190743}
Sun 18 Jan 2026 04:01:05 INFO  [Epoch 2] training [time: 1067.37s, loss: 9.7817, mlm_loss: 5.2086, rec_loss: 8.6477, cl_loss: 0.2308, ]
Sun 18 Jan 2026 04:02:00 INFO  [Epoch 2] Saving current: ./myckpt/Industrial_and_Scientific/Jan-18-2026_03-05-d3f421_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sun 18 Jan 2026 04:02:00 INFO  [Epoch 2] Val Result: {'recall@5': 0.03499068353437285, 'ndcg@5': 0.022075214697658354, 'recall@10': 0.05399627341374914, 'ndcg@10': 0.028191304356488128}
Sun 18 Jan 2026 04:19:45 INFO  [Epoch 3] training [time: 1065.14s, loss: 9.6482, mlm_loss: 5.1060, rec_loss: 8.5400, cl_loss: 0.2175, ]
Sun 18 Jan 2026 04:20:43 INFO  [Epoch 3] Saving current: ./myckpt/Industrial_and_Scientific/Jan-18-2026_03-05-d3f421_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sun 18 Jan 2026 04:20:43 INFO  [Epoch 3] Val Result: {'recall@5': 0.035951750514857314, 'ndcg@5': 0.022833974001114657, 'recall@10': 0.05721290575659508, 'ndcg@10': 0.029665324667966796}
Sun 18 Jan 2026 04:38:30 INFO  [Epoch 4] training [time: 1067.33s, loss: 9.5551, mlm_loss: 5.0499, rec_loss: 8.4611, cl_loss: 0.2100, ]
Sun 18 Jan 2026 04:39:26 INFO  [Epoch 4] Saving current: ./myckpt/Industrial_and_Scientific/Jan-18-2026_03-05-d3f421_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sun 18 Jan 2026 04:39:26 INFO  [Epoch 4] Val Result: {'recall@5': 0.03722663528488771, 'ndcg@5': 0.0239371907054016, 'recall@10': 0.058311268020005885, 'ndcg@10': 0.030746949404095204}
