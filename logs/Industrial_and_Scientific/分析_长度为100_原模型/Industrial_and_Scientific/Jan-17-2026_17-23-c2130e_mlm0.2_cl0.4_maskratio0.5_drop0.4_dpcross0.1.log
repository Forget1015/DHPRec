Sat 17 Jan 2026 17:23:47 INFO  {'seed': 2020, 'dataset': 'Industrial_and_Scientific', 'bidirectional': False, 'n_heads': 2, 'lr': 0.0005, 'tau': 0.07, 'cl_weight': 0.4, 'mlm_weight': 0.2, 'neg_num': 25000, 'text_types': ['title', 'brand', 'features', 'categories', 'description'], 'epochs': 500, 'batch_size': 70, 'num_workers': 8, 'eval_step': 1, 'learner': 'AdamW', 'data_path': './dataset', 'map_path': '.emb_map.json', 'text_index_path': '.code.pq.20_256.pca128.title_brand_features_categories_description.json', 'text_emb_path': '.t5.meta.emb.npy', 'lr_scheduler_type': 'constant', 'gradient_accumulation_steps': 1, 'warmup_steps': 500, 'weight_decay': 0.0001, 'max_his_len': 100, 'n_codes_per_lel': 256, 'code_level': 20, 'early_stop': 100, 'embedding_size': 128, 'hidden_size': 512, 'n_layers': 2, 'n_layers_cross': 2, 'dropout_prob': 0.4, 'dropout_prob_cross': 0.1, 'mask_ratio': 0.5, 'device': 'cuda:1', 'metrics': 'recall@5,ndcg@5,recall@10,ndcg@10', 'valid_metric': 'ndcg@10', 'log_dir': './logs/Industrial_and_Scientific/分析_长度为100_原模型', 'ckpt_dir': './myckpt/', 'resume': None, 'run_local_time': 'Jan-17-2026_17-23', 'save_file_name': 'Jan-17-2026_17-23-c2130e_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1'}
Sat 17 Jan 2026 17:24:11 INFO  MGFSRec(
  (query_code_embedding): Embedding(5121, 128, padding_idx=0)
  (item_text_embedding): ModuleList(
    (0-4): 5 x Embedding(25849, 128, padding_idx=0)
  )
  (qformer): CrossAttTransformer(
    (layer): ModuleList(
      (0-1): 2 x CrossAttTransformerLayer(
        (self_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.1, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.1, inplace=False)
        )
        (cross_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.1, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.1, inplace=False)
        )
        (feed_forward): FeedForward(
          (linear_1): Linear(in_features=128, out_features=512, bias=True)
          (linear_2): Linear(in_features=512, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.1, inplace=False)
        )
      )
    )
  )
  (position_embedding): Embedding(100, 128)
  (transformer): Transformer(
    (layer): ModuleList(
      (0-1): 2 x TransformerLayer(
        (multi_head_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.4, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.4, inplace=False)
        )
        (feed_forward): FeedForward(
          (linear_1): Linear(in_features=128, out_features=512, bias=True)
          (linear_2): Linear(in_features=512, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.4, inplace=False)
        )
      )
    )
  )
  (dropout): Dropout(p=0.4, inplace=False)
  (layer_norm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
  (loss_fct): CrossEntropyLoss()
)
Sat 17 Jan 2026 17:45:35 INFO  [Epoch 0] training [time: 1284.19s, loss: 10.8028, mlm_loss: 6.6374, rec_loss: 9.2459, cl_loss: 0.5734, ]
Sat 17 Jan 2026 17:46:50 INFO  [Epoch 0] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_17-23-c2130e_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 17:46:50 INFO  [Epoch 0] Val Result: {'recall@5': 0.029086986368539767, 'ndcg@5': 0.018197911572687835, 'recall@10': 0.04599391978032755, 'ndcg@10': 0.023620031791141576}
Sat 17 Jan 2026 18:08:13 INFO  [Epoch 1] training [time: 1283.32s, loss: 9.9629, mlm_loss: 5.3778, rec_loss: 8.7981, cl_loss: 0.2232, ]
Sat 17 Jan 2026 18:09:28 INFO  [Epoch 1] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_17-23-c2130e_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 18:09:28 INFO  [Epoch 1] Val Result: {'recall@5': 0.03369618515249583, 'ndcg@5': 0.021267271452795538, 'recall@10': 0.052113366676473476, 'ndcg@10': 0.027187940902402265}
Sat 17 Jan 2026 18:30:53 INFO  [Epoch 2] training [time: 1285.23s, loss: 9.7482, mlm_loss: 5.1891, rec_loss: 8.6286, cl_loss: 0.2045, ]
Sat 17 Jan 2026 18:32:08 INFO  [Epoch 2] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_17-23-c2130e_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 18:32:08 INFO  [Epoch 2] Val Result: {'recall@5': 0.034578797685593805, 'ndcg@5': 0.02169465870088931, 'recall@10': 0.05454545454545454, 'ndcg@10': 0.028141197917320407}
Sat 17 Jan 2026 18:53:28 INFO  [Epoch 3] training [time: 1280.14s, loss: 9.6288, mlm_loss: 5.1122, rec_loss: 8.5272, cl_loss: 0.1978, ]
Sat 17 Jan 2026 18:54:43 INFO  [Epoch 3] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_17-23-c2130e_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 18:54:43 INFO  [Epoch 3] Val Result: {'recall@5': 0.03681474943610866, 'ndcg@5': 0.02326566832923908, 'recall@10': 0.057271746592134944, 'ndcg@10': 0.029882983311702426}
Sat 17 Jan 2026 19:16:05 INFO  [Epoch 4] training [time: 1281.78s, loss: 9.5439, mlm_loss: 5.0658, rec_loss: 8.4529, cl_loss: 0.1947, ]
Sat 17 Jan 2026 19:17:18 INFO  [Epoch 4] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_17-23-c2130e_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 19:17:18 INFO  [Epoch 4] Val Result: {'recall@5': 0.03746199862704717, 'ndcg@5': 0.023736796048127798, 'recall@10': 0.059252721388643716, 'ndcg@10': 0.030765205859623553}
Sat 17 Jan 2026 19:38:40 INFO  [Epoch 5] training [time: 1281.78s, loss: 9.4786, mlm_loss: 5.0242, rec_loss: 8.3959, cl_loss: 0.1946, ]
Sat 17 Jan 2026 19:39:56 INFO  [Epoch 5] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_17-23-c2130e_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 19:39:56 INFO  [Epoch 5] Val Result: {'recall@5': 0.0383053839364519, 'ndcg@5': 0.024323841402480867, 'recall@10': 0.05970383446111602, 'ndcg@10': 0.03119362136061383}
Sat 17 Jan 2026 20:01:18 INFO  [Epoch 6] training [time: 1282.27s, loss: 9.4245, mlm_loss: 4.9864, rec_loss: 8.3503, cl_loss: 0.1923, ]
Sat 17 Jan 2026 20:02:32 INFO  [Epoch 6] Val Result: {'recall@5': 0.03903108757477689, 'ndcg@5': 0.024342643132662906, 'recall@10': 0.060076493086201825, 'ndcg@10': 0.03113070139525345}
Sat 17 Jan 2026 20:23:52 INFO  [Epoch 7] training [time: 1280.17s, loss: 9.3750, mlm_loss: 4.9530, rec_loss: 8.3084, cl_loss: 0.1898, ]
Sat 17 Jan 2026 20:25:07 INFO  [Epoch 7] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_17-23-c2130e_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 20:25:07 INFO  [Epoch 7] Val Result: {'recall@5': 0.03863881533784446, 'ndcg@5': 0.02398466113397651, 'recall@10': 0.061076787290379526, 'ndcg@10': 0.03119663328262618}
Sat 17 Jan 2026 20:46:28 INFO  [Epoch 8] training [time: 1280.47s, loss: 9.3325, mlm_loss: 4.9264, rec_loss: 8.2716, cl_loss: 0.1891, ]
Sat 17 Jan 2026 20:47:41 INFO  [Epoch 8] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_17-23-c2130e_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 20:47:41 INFO  [Epoch 8] Val Result: {'recall@5': 0.039658723153868786, 'ndcg@5': 0.024764586409786418, 'recall@10': 0.061979013435324116, 'ndcg@10': 0.03192641954451458}
Sat 17 Jan 2026 21:09:03 INFO  [Epoch 9] training [time: 1282.25s, loss: 9.2960, mlm_loss: 4.9044, rec_loss: 8.2407, cl_loss: 0.1859, ]
Sat 17 Jan 2026 21:10:19 INFO  [Epoch 9] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_17-23-c2130e_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sat 17 Jan 2026 21:10:19 INFO  [Epoch 9] Val Result: {'recall@5': 0.04136510738452486, 'ndcg@5': 0.026184585822310133, 'recall@10': 0.06399921545552613, 'ndcg@10': 0.033497972037495966}
Sat 17 Jan 2026 21:31:47 INFO  [Epoch 10] training [time: 1287.40s, loss: 9.2644, mlm_loss: 4.8863, rec_loss: 8.2129, cl_loss: 0.1856, ]
Sat 17 Jan 2026 21:33:01 INFO  [Epoch 10] Val Result: {'recall@5': 0.04101206237128567, 'ndcg@5': 0.025931365762117436, 'recall@10': 0.06337157987643424, 'ndcg@10': 0.03312961369843486}
Sat 17 Jan 2026 21:54:20 INFO  [Epoch 11] training [time: 1278.96s, loss: 9.2353, mlm_loss: 4.8700, rec_loss: 8.1877, cl_loss: 0.1842, ]
Sat 17 Jan 2026 21:55:34 INFO  [Epoch 11] Val Result: {'recall@5': 0.04087476708835932, 'ndcg@5': 0.02555622450040698, 'recall@10': 0.06260664901441601, 'ndcg@10': 0.03254801376644298}
Sat 17 Jan 2026 22:17:02 INFO  [Epoch 12] training [time: 1287.24s, loss: 9.2080, mlm_loss: 4.8551, rec_loss: 8.1640, cl_loss: 0.1824, ]
Sat 17 Jan 2026 22:18:15 INFO  [Epoch 12] Val Result: {'recall@5': 0.04089438070020594, 'ndcg@5': 0.025666767079374, 'recall@10': 0.0637834657252133, 'ndcg@10': 0.033021249714535544}
Sat 17 Jan 2026 22:39:38 INFO  [Epoch 13] training [time: 1282.26s, loss: 9.1853, mlm_loss: 4.8432, rec_loss: 8.1437, cl_loss: 0.1823, ]
Sat 17 Jan 2026 22:40:51 INFO  [Epoch 13] Val Result: {'recall@5': 0.04093360792389918, 'ndcg@5': 0.025456200920157167, 'recall@10': 0.0635088751593606, 'ndcg@10': 0.03270024643629874}
Sat 17 Jan 2026 23:02:10 INFO  [Epoch 14] training [time: 1278.49s, loss: 9.1630, mlm_loss: 4.8352, rec_loss: 8.1230, cl_loss: 0.1824, ]
Sat 17 Jan 2026 23:03:24 INFO  [Epoch 14] Val Result: {'recall@5': 0.041168971266058646, 'ndcg@5': 0.02577110389126064, 'recall@10': 0.06327351181720113, 'ndcg@10': 0.032841423321345445}
Sat 17 Jan 2026 23:24:44 INFO  [Epoch 15] training [time: 1279.29s, loss: 9.1415, mlm_loss: 4.8251, rec_loss: 8.1040, cl_loss: 0.1811, ]
Sat 17 Jan 2026 23:25:57 INFO  [Epoch 15] Val Result: {'recall@5': 0.041718152397764045, 'ndcg@5': 0.026129250485744854, 'recall@10': 0.06411689712660587, 'ndcg@10': 0.033334503044529826}
Sat 17 Jan 2026 23:47:20 INFO  [Epoch 16] training [time: 1283.63s, loss: 9.1226, mlm_loss: 4.8174, rec_loss: 8.0862, cl_loss: 0.1822, ]
Sat 17 Jan 2026 23:48:35 INFO  [Epoch 16] Val Result: {'recall@5': 0.04126703932529175, 'ndcg@5': 0.025763280545775535, 'recall@10': 0.06409728351475924, 'ndcg@10': 0.033096609221868356}
Sun 18 Jan 2026 00:09:59 INFO  [Epoch 17] training [time: 1284.66s, loss: 9.1063, mlm_loss: 4.8112, rec_loss: 8.0720, cl_loss: 0.1802, ]
Sun 18 Jan 2026 00:11:15 INFO  [Epoch 17] Val Result: {'recall@5': 0.041384720996371485, 'ndcg@5': 0.02619678165511172, 'recall@10': 0.06362655683044033, 'ndcg@10': 0.03332029751460786}
Sun 18 Jan 2026 00:32:37 INFO  [Epoch 18] training [time: 1281.33s, loss: 9.0884, mlm_loss: 4.8065, rec_loss: 8.0546, cl_loss: 0.1814, ]
Sun 18 Jan 2026 00:33:51 INFO  [Epoch 18] Val Result: {'recall@5': 0.040992448759439054, 'ndcg@5': 0.025699982699125528, 'recall@10': 0.06307737569873492, 'ndcg@10': 0.03277743946129964}
Sun 18 Jan 2026 00:55:11 INFO  [Epoch 19] training [time: 1279.61s, loss: 9.0746, mlm_loss: 4.7997, rec_loss: 8.0426, cl_loss: 0.1802, ]
Sun 18 Jan 2026 00:56:24 INFO  [Epoch 19] Val Result: {'recall@5': 0.041168971266058646, 'ndcg@5': 0.025774720970808296, 'recall@10': 0.0650583504952437, 'ndcg@10': 0.03343627368970117}
Sun 18 Jan 2026 01:17:40 INFO  [Epoch 20] training [time: 1276.12s, loss: 9.0570, mlm_loss: 4.7951, rec_loss: 8.0262, cl_loss: 0.1794, ]
Sun 18 Jan 2026 01:18:54 INFO  [Epoch 20] Saving current: ./myckpt/Industrial_and_Scientific/Jan-17-2026_17-23-c2130e_mlm0.2_cl0.4_maskratio0.5_drop0.4_dpcross0.1/best_model.pth
Sun 18 Jan 2026 01:18:54 INFO  [Epoch 20] Val Result: {'recall@5': 0.04199274296361675, 'ndcg@5': 0.026324105538070536, 'recall@10': 0.06537216828478964, 'ndcg@10': 0.03382912416592338}
Sun 18 Jan 2026 01:40:18 INFO  [Epoch 21] training [time: 1284.69s, loss: 9.0431, mlm_loss: 4.7918, rec_loss: 8.0130, cl_loss: 0.1793, ]
Sun 18 Jan 2026 01:41:32 INFO  [Epoch 21] Val Result: {'recall@5': 0.04173776600961067, 'ndcg@5': 0.026122083032179128, 'recall@10': 0.0646072374227714, 'ndcg@10': 0.03348871143037015}
Sun 18 Jan 2026 02:02:57 INFO  [Epoch 22] training [time: 1285.16s, loss: 9.0311, mlm_loss: 4.7884, rec_loss: 8.0014, cl_loss: 0.1800, ]
Sun 18 Jan 2026 02:04:11 INFO  [Epoch 22] Val Result: {'recall@5': 0.04134549377267824, 'ndcg@5': 0.026132057069551365, 'recall@10': 0.06448955575169167, 'ndcg@10': 0.033601010576397625}
Sun 18 Jan 2026 02:25:37 INFO  [Epoch 23] training [time: 1285.42s, loss: 9.0174, mlm_loss: 4.7851, rec_loss: 7.9887, cl_loss: 0.1792, ]
Sun 18 Jan 2026 02:26:51 INFO  [Epoch 23] Val Result: {'recall@5': 0.04175737962145729, 'ndcg@5': 0.025978710311317463, 'recall@10': 0.06403844267921938, 'ndcg@10': 0.03315615117801245}
